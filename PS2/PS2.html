<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PS2_Mahnoor Arif</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="PS2_files/libs/clipboard/clipboard.min.js"></script>
<script src="PS2_files/libs/quarto-html/quarto.js"></script>
<script src="PS2_files/libs/quarto-html/popper.min.js"></script>
<script src="PS2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="PS2_files/libs/quarto-html/anchor.min.js"></script>
<link href="PS2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PS2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="PS2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="PS2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="PS2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PS2_Mahnoor Arif</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="5e07590c" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d8062e00" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tickets_data <span class="op">=</span> pd.read_csv(<span class="st">'C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">student30538</span><span class="ch">\\</span><span class="st">PS2</span><span class="ch">\\</span><span class="st">parking_tickets_one_percent.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\arifm\AppData\Local\Temp\ipykernel_11404\413930792.py:1: DtypeWarning: Columns (7) have mixed types. Specify dtype option on import or set low_memory=False.
  tickets_data = pd.read_csv('C:\\Users\\arifm\\OneDrive\\Documents\\GitHub\\student30538\\PS2\\parking_tickets_one_percent.csv')</code></pre>
</div>
</div>
<div id="d5d390f0" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install altair_saver</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>##Data cleaning continued (15 points)</p>
<div id="a3d88337" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1.1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Define a function to count NAs for each column</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_na_per_column(dataframe):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dictionary where keys are column names and values are the number of NAs</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    na_counts <span class="op">=</span> dataframe.isna().<span class="bu">sum</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the result to a DataFrame called countNA</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    na_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Variable'</span>: na_counts.index,   <span class="co"># Column names</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'NA_Count'</span>: na_counts.values   <span class="co"># NA counts</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> na_df</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Apply the function to the parking tickets data frame</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>na_report <span class="op">=</span> count_na_per_column(tickets_data)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Print the results</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(na_report)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Variable  NA_Count
0              Unnamed: 0         0
1           ticket_number         0
2              issue_date         0
3      violation_location         0
4    license_plate_number         0
5     license_plate_state        97
6      license_plate_type      2054
7                 zipcode     54115
8          violation_code         0
9   violation_description         0
10                   unit        29
11       unit_description         0
12           vehicle_make         0
13     fine_level1_amount         0
14     fine_level2_amount         0
15     current_amount_due         0
16         total_payments         0
17           ticket_queue         0
18      ticket_queue_date         0
19           notice_level     84068
20    hearing_disposition    259899
21          notice_number         0
22                officer         0
23                address         0</code></pre>
</div>
</div>
<div id="043d78a8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1.2</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#The three variables with most missing values include: notice_level, hearing_disposition and zip_code##  The reason why many have blank values because possibly due to data entry constraints. If antering exact details of these variables is not mandatory, then these fields most likely to be omitted during data entry.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="09758630" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1.3</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">## New code: 0964125B</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">## old code: 0964125</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="de3c37b6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1.4</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#NO CITY STICKER OR IMPROPER DISPLAY    $ 120</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS. $200</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6e797004" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">##2.1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import altair as alt</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the issue_date to datetime format</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'issue_date'</span>] <span class="op">=</span> pd.to_datetime(tickets_data[<span class="st">'issue_date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Combine old and new violation codes (0964125 and 0964125B)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'violation_code_combined'</span>] <span class="op">=</span> tickets_data[<span class="st">'violation_code'</span>].replace({<span class="st">'0964125B'</span>: <span class="st">'0964125'</span>})</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Filter the data for the missing city sticker violation codes only</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>df_missing_sticker <span class="op">=</span> tickets_data[tickets_data[<span class="st">'violation_code_combined'</span>] <span class="op">==</span> <span class="st">'0964125'</span>]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Group by month and count the number of missing city sticker tickets</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>df_missing_sticker[<span class="st">'month'</span>] <span class="op">=</span> df_missing_sticker[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>tickets_by_month <span class="op">=</span> df_missing_sticker.groupby(<span class="st">'month'</span>).size().reset_index(name<span class="op">=</span><span class="st">'num_tickets'</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'month' Period objects to string format for Altair compatibility</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>tickets_by_month[<span class="st">'month'</span>] <span class="op">=</span> tickets_by_month[<span class="st">'month'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Plot the number of tickets over time using Altair</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(tickets_by_month).mark_line(point<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'month:T'</span>,  <span class="co"># Treat 'month' as time type</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'num_tickets:Q'</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'month:T'</span>, <span class="st">'num_tickets:Q'</span>]</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Missing City Sticker Tickets Over Time'</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>).configure_axis(</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    grid<span class="op">=</span><span class="va">True</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>).configure_view(</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    stroke<span class="op">=</span><span class="st">'transparent'</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the chart</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>chart.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\arifm\AppData\Local\Temp\ipykernel_11404\1099920220.py:15: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_missing_sticker['month'] = df_missing_sticker['issue_date'].dt.to_period('M')</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-dee3bd5ff5cb439b9b2213093b9479c6.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-dee3bd5ff5cb439b9b2213093b9479c6.vega-embed details,
  #altair-viz-dee3bd5ff5cb439b9b2213093b9479c6.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-dee3bd5ff5cb439b9b2213093b9479c6"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-dee3bd5ff5cb439b9b2213093b9479c6") {
      outputDiv = document.getElementById("altair-viz-dee3bd5ff5cb439b9b2213093b9479c6");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300, "stroke": "transparent"}, "axis": {"grid": true}}, "data": {"name": "data-ec4d1e8bdf15e0f533752eb515694401"}, "mark": {"type": "line", "point": true}, "encoding": {"tooltip": [{"field": "month", "type": "temporal"}, {"field": "num_tickets", "type": "quantitative"}], "x": {"field": "month", "type": "temporal"}, "y": {"field": "num_tickets", "type": "quantitative"}}, "title": "Number of Missing City Sticker Tickets Over Time", "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-ec4d1e8bdf15e0f533752eb515694401": [{"month": "2007-01", "num_tickets": 160}, {"month": "2007-02", "num_tickets": 104}, {"month": "2007-03", "num_tickets": 161}, {"month": "2007-04", "num_tickets": 158}, {"month": "2007-05", "num_tickets": 126}, {"month": "2007-06", "num_tickets": 80}, {"month": "2007-07", "num_tickets": 399}, {"month": "2007-08", "num_tickets": 345}, {"month": "2007-09", "num_tickets": 224}, {"month": "2007-10", "num_tickets": 221}, {"month": "2007-11", "num_tickets": 168}, {"month": "2007-12", "num_tickets": 118}, {"month": "2008-01", "num_tickets": 132}, {"month": "2008-02", "num_tickets": 149}, {"month": "2008-03", "num_tickets": 192}, {"month": "2008-04", "num_tickets": 166}, {"month": "2008-05", "num_tickets": 139}, {"month": "2008-06", "num_tickets": 72}, {"month": "2008-07", "num_tickets": 382}, {"month": "2008-08", "num_tickets": 342}, {"month": "2008-09", "num_tickets": 213}, {"month": "2008-10", "num_tickets": 197}, {"month": "2008-11", "num_tickets": 148}, {"month": "2008-12", "num_tickets": 80}, {"month": "2009-01", "num_tickets": 81}, {"month": "2009-02", "num_tickets": 121}, {"month": "2009-03", "num_tickets": 171}, {"month": "2009-04", "num_tickets": 149}, {"month": "2009-05", "num_tickets": 132}, {"month": "2009-06", "num_tickets": 89}, {"month": "2009-07", "num_tickets": 392}, {"month": "2009-08", "num_tickets": 347}, {"month": "2009-09", "num_tickets": 211}, {"month": "2009-10", "num_tickets": 188}, {"month": "2009-11", "num_tickets": 170}, {"month": "2009-12", "num_tickets": 98}, {"month": "2010-01", "num_tickets": 156}, {"month": "2010-02", "num_tickets": 129}, {"month": "2010-03", "num_tickets": 153}, {"month": "2010-04", "num_tickets": 138}, {"month": "2010-05", "num_tickets": 140}, {"month": "2010-06", "num_tickets": 99}, {"month": "2010-07", "num_tickets": 26}, {"month": "2010-08", "num_tickets": 425}, {"month": "2010-09", "num_tickets": 237}, {"month": "2010-10", "num_tickets": 197}, {"month": "2010-11", "num_tickets": 168}, {"month": "2010-12", "num_tickets": 117}, {"month": "2011-01", "num_tickets": 153}, {"month": "2011-02", "num_tickets": 87}, {"month": "2011-03", "num_tickets": 147}, {"month": "2011-04", "num_tickets": 135}, {"month": "2011-05", "num_tickets": 134}, {"month": "2011-06", "num_tickets": 78}, {"month": "2011-07", "num_tickets": 317}, {"month": "2011-08", "num_tickets": 313}, {"month": "2011-09", "num_tickets": 171}, {"month": "2011-10", "num_tickets": 136}, {"month": "2011-11", "num_tickets": 139}, {"month": "2011-12", "num_tickets": 123}, {"month": "2012-01", "num_tickets": 114}, {"month": "2012-02", "num_tickets": 138}, {"month": "2012-03", "num_tickets": 181}, {"month": "2012-04", "num_tickets": 142}, {"month": "2012-05", "num_tickets": 115}, {"month": "2012-06", "num_tickets": 100}, {"month": "2012-07", "num_tickets": 414}, {"month": "2012-08", "num_tickets": 319}, {"month": "2012-09", "num_tickets": 179}, {"month": "2012-10", "num_tickets": 171}, {"month": "2012-11", "num_tickets": 157}, {"month": "2012-12", "num_tickets": 162}, {"month": "2013-01", "num_tickets": 196}, {"month": "2013-02", "num_tickets": 158}, {"month": "2013-03", "num_tickets": 199}, {"month": "2013-04", "num_tickets": 187}, {"month": "2013-05", "num_tickets": 179}, {"month": "2013-06", "num_tickets": 140}, {"month": "2013-07", "num_tickets": 499}, {"month": "2013-08", "num_tickets": 355}, {"month": "2013-09", "num_tickets": 221}, {"month": "2013-10", "num_tickets": 208}, {"month": "2013-11", "num_tickets": 127}, {"month": "2013-12", "num_tickets": 98}, {"month": "2014-01", "num_tickets": 100}, {"month": "2014-02", "num_tickets": 147}, {"month": "2014-03", "num_tickets": 155}, {"month": "2014-04", "num_tickets": 144}, {"month": "2014-05", "num_tickets": 178}, {"month": "2014-06", "num_tickets": 116}, {"month": "2014-07", "num_tickets": 267}, {"month": "2014-08", "num_tickets": 245}, {"month": "2014-09", "num_tickets": 178}, {"month": "2014-10", "num_tickets": 165}, {"month": "2014-11", "num_tickets": 153}, {"month": "2014-12", "num_tickets": 177}, {"month": "2015-01", "num_tickets": 179}, {"month": "2015-02", "num_tickets": 142}, {"month": "2015-03", "num_tickets": 223}, {"month": "2015-04", "num_tickets": 191}, {"month": "2015-05", "num_tickets": 191}, {"month": "2015-06", "num_tickets": 198}, {"month": "2015-07", "num_tickets": 217}, {"month": "2015-08", "num_tickets": 210}, {"month": "2015-09", "num_tickets": 225}, {"month": "2015-10", "num_tickets": 245}, {"month": "2015-11", "num_tickets": 226}, {"month": "2015-12", "num_tickets": 220}, {"month": "2016-01", "num_tickets": 202}, {"month": "2016-02", "num_tickets": 206}, {"month": "2016-03", "num_tickets": 241}, {"month": "2016-04", "num_tickets": 203}, {"month": "2016-05", "num_tickets": 185}, {"month": "2016-06", "num_tickets": 175}, {"month": "2016-07", "num_tickets": 160}, {"month": "2016-08", "num_tickets": 151}, {"month": "2016-09", "num_tickets": 183}, {"month": "2016-10", "num_tickets": 220}, {"month": "2016-11", "num_tickets": 182}, {"month": "2016-12", "num_tickets": 156}, {"month": "2017-01", "num_tickets": 238}, {"month": "2017-02", "num_tickets": 190}, {"month": "2017-03", "num_tickets": 211}, {"month": "2017-04", "num_tickets": 191}, {"month": "2017-05", "num_tickets": 192}, {"month": "2017-06", "num_tickets": 177}, {"month": "2017-07", "num_tickets": 166}, {"month": "2017-08", "num_tickets": 173}, {"month": "2017-09", "num_tickets": 188}, {"month": "2017-10", "num_tickets": 169}, {"month": "2017-11", "num_tickets": 202}, {"month": "2017-12", "num_tickets": 159}, {"month": "2018-01", "num_tickets": 168}, {"month": "2018-02", "num_tickets": 119}, {"month": "2018-03", "num_tickets": 171}, {"month": "2018-04", "num_tickets": 153}, {"month": "2018-05", "num_tickets": 79}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="d6115ae9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">##2.2</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import altair as alt</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure issue_date is in datetime format</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'issue_date'</span>] <span class="op">=</span> pd.to_datetime(tickets_data[<span class="st">'issue_date'</span>])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two violation codes</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>old_code <span class="op">=</span> <span class="st">'0964125'</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>new_code <span class="op">=</span> <span class="st">'0964125B'</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'city_sticker_violation'</span>] <span class="op">=</span> tickets_data[<span class="st">'violation_code'</span>].isin([old_code, new_code])</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for city sticker violations</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="op">=</span> tickets_data[tickets_data[<span class="st">'city_sticker_violation'</span>]]</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by month for city sticker violations</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>df_monthly <span class="op">=</span> filtered_data.groupby(filtered_data[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)).size().reset_index(name<span class="op">=</span><span class="st">'ticket_count'</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the period back to a timestamp for plotting</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>df_monthly[<span class="st">'issue_date'</span>] <span class="op">=</span> df_monthly[<span class="st">'issue_date'</span>].dt.to_timestamp()</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the number of tickets over time and add custom date labels</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>price_increase_date <span class="op">=</span> <span class="st">'2012-02-24'</span>  <span class="co"># Price increase occured in 3/6/2012.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(df_monthly).mark_line().encode(</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'issue_date:T'</span>, axis<span class="op">=</span>alt.Axis(<span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>, labelAngle<span class="op">=-</span><span class="dv">45</span>)),  <span class="co"># Custom date format</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'ticket_count'</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Missing City Sticker Tickets Over Time'</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a vertical line to indicate the price increase date</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>rule <span class="op">=</span> alt.Chart(pd.DataFrame({<span class="st">'price_increase'</span>: [price_increase_date]})).mark_rule(color<span class="op">=</span><span class="st">'red'</span>).encode(</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'price_increase:T'</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the line chart and the rule</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>final_chart <span class="op">=</span> chart <span class="op">+</span> rule</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>final_chart.display()</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co">##Help page: I filtered for the exact price change year using pivot tables on Excel.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-918e360d0712460e9a9fe4b833bfd8fe.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-918e360d0712460e9a9fe4b833bfd8fe.vega-embed details,
  #altair-viz-918e360d0712460e9a9fe4b833bfd8fe.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-918e360d0712460e9a9fe4b833bfd8fe"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-918e360d0712460e9a9fe4b833bfd8fe") {
      outputDiv = document.getElementById("altair-viz-918e360d0712460e9a9fe4b833bfd8fe");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"data": {"name": "data-953883e3eaeff663890382dbdbd39466"}, "mark": {"type": "line"}, "encoding": {"x": {"axis": {"format": "%Y-%m", "labelAngle": -45}, "field": "issue_date", "type": "temporal"}, "y": {"field": "ticket_count", "type": "quantitative"}}, "title": "Missing City Sticker Tickets Over Time"}, {"data": {"name": "data-12ce4e14d50c601734fecf6ec8da676a"}, "mark": {"type": "rule", "color": "red"}, "encoding": {"x": {"field": "price_increase", "type": "temporal"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-953883e3eaeff663890382dbdbd39466": [{"issue_date": "2007-01-01T00:00:00", "ticket_count": 160}, {"issue_date": "2007-02-01T00:00:00", "ticket_count": 104}, {"issue_date": "2007-03-01T00:00:00", "ticket_count": 161}, {"issue_date": "2007-04-01T00:00:00", "ticket_count": 158}, {"issue_date": "2007-05-01T00:00:00", "ticket_count": 126}, {"issue_date": "2007-06-01T00:00:00", "ticket_count": 80}, {"issue_date": "2007-07-01T00:00:00", "ticket_count": 399}, {"issue_date": "2007-08-01T00:00:00", "ticket_count": 345}, {"issue_date": "2007-09-01T00:00:00", "ticket_count": 224}, {"issue_date": "2007-10-01T00:00:00", "ticket_count": 221}, {"issue_date": "2007-11-01T00:00:00", "ticket_count": 168}, {"issue_date": "2007-12-01T00:00:00", "ticket_count": 118}, {"issue_date": "2008-01-01T00:00:00", "ticket_count": 132}, {"issue_date": "2008-02-01T00:00:00", "ticket_count": 149}, {"issue_date": "2008-03-01T00:00:00", "ticket_count": 192}, {"issue_date": "2008-04-01T00:00:00", "ticket_count": 166}, {"issue_date": "2008-05-01T00:00:00", "ticket_count": 139}, {"issue_date": "2008-06-01T00:00:00", "ticket_count": 72}, {"issue_date": "2008-07-01T00:00:00", "ticket_count": 382}, {"issue_date": "2008-08-01T00:00:00", "ticket_count": 342}, {"issue_date": "2008-09-01T00:00:00", "ticket_count": 213}, {"issue_date": "2008-10-01T00:00:00", "ticket_count": 197}, {"issue_date": "2008-11-01T00:00:00", "ticket_count": 148}, {"issue_date": "2008-12-01T00:00:00", "ticket_count": 80}, {"issue_date": "2009-01-01T00:00:00", "ticket_count": 81}, {"issue_date": "2009-02-01T00:00:00", "ticket_count": 121}, {"issue_date": "2009-03-01T00:00:00", "ticket_count": 171}, {"issue_date": "2009-04-01T00:00:00", "ticket_count": 149}, {"issue_date": "2009-05-01T00:00:00", "ticket_count": 132}, {"issue_date": "2009-06-01T00:00:00", "ticket_count": 89}, {"issue_date": "2009-07-01T00:00:00", "ticket_count": 392}, {"issue_date": "2009-08-01T00:00:00", "ticket_count": 347}, {"issue_date": "2009-09-01T00:00:00", "ticket_count": 211}, {"issue_date": "2009-10-01T00:00:00", "ticket_count": 188}, {"issue_date": "2009-11-01T00:00:00", "ticket_count": 170}, {"issue_date": "2009-12-01T00:00:00", "ticket_count": 98}, {"issue_date": "2010-01-01T00:00:00", "ticket_count": 156}, {"issue_date": "2010-02-01T00:00:00", "ticket_count": 129}, {"issue_date": "2010-03-01T00:00:00", "ticket_count": 153}, {"issue_date": "2010-04-01T00:00:00", "ticket_count": 138}, {"issue_date": "2010-05-01T00:00:00", "ticket_count": 140}, {"issue_date": "2010-06-01T00:00:00", "ticket_count": 99}, {"issue_date": "2010-07-01T00:00:00", "ticket_count": 26}, {"issue_date": "2010-08-01T00:00:00", "ticket_count": 425}, {"issue_date": "2010-09-01T00:00:00", "ticket_count": 237}, {"issue_date": "2010-10-01T00:00:00", "ticket_count": 197}, {"issue_date": "2010-11-01T00:00:00", "ticket_count": 168}, {"issue_date": "2010-12-01T00:00:00", "ticket_count": 117}, {"issue_date": "2011-01-01T00:00:00", "ticket_count": 153}, {"issue_date": "2011-02-01T00:00:00", "ticket_count": 87}, {"issue_date": "2011-03-01T00:00:00", "ticket_count": 147}, {"issue_date": "2011-04-01T00:00:00", "ticket_count": 135}, {"issue_date": "2011-05-01T00:00:00", "ticket_count": 134}, {"issue_date": "2011-06-01T00:00:00", "ticket_count": 78}, {"issue_date": "2011-07-01T00:00:00", "ticket_count": 317}, {"issue_date": "2011-08-01T00:00:00", "ticket_count": 313}, {"issue_date": "2011-09-01T00:00:00", "ticket_count": 171}, {"issue_date": "2011-10-01T00:00:00", "ticket_count": 136}, {"issue_date": "2011-11-01T00:00:00", "ticket_count": 139}, {"issue_date": "2011-12-01T00:00:00", "ticket_count": 123}, {"issue_date": "2012-01-01T00:00:00", "ticket_count": 114}, {"issue_date": "2012-02-01T00:00:00", "ticket_count": 138}, {"issue_date": "2012-03-01T00:00:00", "ticket_count": 181}, {"issue_date": "2012-04-01T00:00:00", "ticket_count": 142}, {"issue_date": "2012-05-01T00:00:00", "ticket_count": 115}, {"issue_date": "2012-06-01T00:00:00", "ticket_count": 100}, {"issue_date": "2012-07-01T00:00:00", "ticket_count": 414}, {"issue_date": "2012-08-01T00:00:00", "ticket_count": 319}, {"issue_date": "2012-09-01T00:00:00", "ticket_count": 179}, {"issue_date": "2012-10-01T00:00:00", "ticket_count": 171}, {"issue_date": "2012-11-01T00:00:00", "ticket_count": 157}, {"issue_date": "2012-12-01T00:00:00", "ticket_count": 162}, {"issue_date": "2013-01-01T00:00:00", "ticket_count": 196}, {"issue_date": "2013-02-01T00:00:00", "ticket_count": 158}, {"issue_date": "2013-03-01T00:00:00", "ticket_count": 199}, {"issue_date": "2013-04-01T00:00:00", "ticket_count": 187}, {"issue_date": "2013-05-01T00:00:00", "ticket_count": 179}, {"issue_date": "2013-06-01T00:00:00", "ticket_count": 140}, {"issue_date": "2013-07-01T00:00:00", "ticket_count": 499}, {"issue_date": "2013-08-01T00:00:00", "ticket_count": 355}, {"issue_date": "2013-09-01T00:00:00", "ticket_count": 221}, {"issue_date": "2013-10-01T00:00:00", "ticket_count": 208}, {"issue_date": "2013-11-01T00:00:00", "ticket_count": 127}, {"issue_date": "2013-12-01T00:00:00", "ticket_count": 98}, {"issue_date": "2014-01-01T00:00:00", "ticket_count": 100}, {"issue_date": "2014-02-01T00:00:00", "ticket_count": 147}, {"issue_date": "2014-03-01T00:00:00", "ticket_count": 155}, {"issue_date": "2014-04-01T00:00:00", "ticket_count": 144}, {"issue_date": "2014-05-01T00:00:00", "ticket_count": 178}, {"issue_date": "2014-06-01T00:00:00", "ticket_count": 116}, {"issue_date": "2014-07-01T00:00:00", "ticket_count": 267}, {"issue_date": "2014-08-01T00:00:00", "ticket_count": 245}, {"issue_date": "2014-09-01T00:00:00", "ticket_count": 178}, {"issue_date": "2014-10-01T00:00:00", "ticket_count": 165}, {"issue_date": "2014-11-01T00:00:00", "ticket_count": 153}, {"issue_date": "2014-12-01T00:00:00", "ticket_count": 177}, {"issue_date": "2015-01-01T00:00:00", "ticket_count": 179}, {"issue_date": "2015-02-01T00:00:00", "ticket_count": 142}, {"issue_date": "2015-03-01T00:00:00", "ticket_count": 223}, {"issue_date": "2015-04-01T00:00:00", "ticket_count": 191}, {"issue_date": "2015-05-01T00:00:00", "ticket_count": 191}, {"issue_date": "2015-06-01T00:00:00", "ticket_count": 198}, {"issue_date": "2015-07-01T00:00:00", "ticket_count": 217}, {"issue_date": "2015-08-01T00:00:00", "ticket_count": 210}, {"issue_date": "2015-09-01T00:00:00", "ticket_count": 225}, {"issue_date": "2015-10-01T00:00:00", "ticket_count": 245}, {"issue_date": "2015-11-01T00:00:00", "ticket_count": 226}, {"issue_date": "2015-12-01T00:00:00", "ticket_count": 220}, {"issue_date": "2016-01-01T00:00:00", "ticket_count": 202}, {"issue_date": "2016-02-01T00:00:00", "ticket_count": 206}, {"issue_date": "2016-03-01T00:00:00", "ticket_count": 241}, {"issue_date": "2016-04-01T00:00:00", "ticket_count": 203}, {"issue_date": "2016-05-01T00:00:00", "ticket_count": 185}, {"issue_date": "2016-06-01T00:00:00", "ticket_count": 175}, {"issue_date": "2016-07-01T00:00:00", "ticket_count": 160}, {"issue_date": "2016-08-01T00:00:00", "ticket_count": 151}, {"issue_date": "2016-09-01T00:00:00", "ticket_count": 183}, {"issue_date": "2016-10-01T00:00:00", "ticket_count": 220}, {"issue_date": "2016-11-01T00:00:00", "ticket_count": 182}, {"issue_date": "2016-12-01T00:00:00", "ticket_count": 156}, {"issue_date": "2017-01-01T00:00:00", "ticket_count": 238}, {"issue_date": "2017-02-01T00:00:00", "ticket_count": 190}, {"issue_date": "2017-03-01T00:00:00", "ticket_count": 211}, {"issue_date": "2017-04-01T00:00:00", "ticket_count": 191}, {"issue_date": "2017-05-01T00:00:00", "ticket_count": 192}, {"issue_date": "2017-06-01T00:00:00", "ticket_count": 177}, {"issue_date": "2017-07-01T00:00:00", "ticket_count": 166}, {"issue_date": "2017-08-01T00:00:00", "ticket_count": 173}, {"issue_date": "2017-09-01T00:00:00", "ticket_count": 188}, {"issue_date": "2017-10-01T00:00:00", "ticket_count": 169}, {"issue_date": "2017-11-01T00:00:00", "ticket_count": 202}, {"issue_date": "2017-12-01T00:00:00", "ticket_count": 159}, {"issue_date": "2018-01-01T00:00:00", "ticket_count": 168}, {"issue_date": "2018-02-01T00:00:00", "ticket_count": 119}, {"issue_date": "2018-03-01T00:00:00", "ticket_count": 171}, {"issue_date": "2018-04-01T00:00:00", "ticket_count": 153}, {"issue_date": "2018-05-01T00:00:00", "ticket_count": 79}], "data-12ce4e14d50c601734fecf6ec8da676a": [{"price_increase": "2012-02-24"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="e8ead39e" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">##2.3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ticket count in the 1% sample</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ticket_count_sample <span class="op">=</span> <span class="dv">175</span>  <span class="co"># The number of tickets in the 1% sample</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>ticket_price_before <span class="op">=</span> <span class="dv">120</span>   <span class="co"># Assuming the price was $120 before the increase</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>ticket_price_after <span class="op">=</span> <span class="dv">200</span>    <span class="co"># The new price after the increase</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>sample_percentage <span class="op">=</span> <span class="fl">0.01</span>    <span class="co"># 1% sample of the total data</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Calculate revenue before the price increase (for 1% sample)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>revenue_before_sample <span class="op">=</span> ticket_count_sample <span class="op">*</span> ticket_price_before</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate revenue after the price increase (for 1% sample)</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>revenue_after_sample <span class="op">=</span> ticket_count_sample <span class="op">*</span> ticket_price_after</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Project total revenue increase (scale from 1% sample to 100% of tickets)</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>total_revenue_before <span class="op">=</span> revenue_before_sample <span class="op">/</span> sample_percentage</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>total_revenue_after <span class="op">=</span> revenue_after_sample <span class="op">/</span> sample_percentage</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Calculate projected increase in revenue</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>projected_increase <span class="op">=</span> total_revenue_after <span class="op">-</span> total_revenue_before</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Compare with the claimed $16 million increase</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Projected Revenue Before Increase (scaled): $</span><span class="sc">{</span>total_revenue_before<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Projected Revenue After Increase (scaled): $</span><span class="sc">{</span>total_revenue_after<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Projected Revenue Increase: $</span><span class="sc">{</span>projected_increase<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"City Clerk's Claimed Revenue Increase: $16,000,000"</span>)  </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare if projected increase matches the claim</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> projected_increase <span class="op">&gt;=</span> <span class="dv">16_000_000</span>:</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"The projected revenue increase meets or exceeds the City's claim of $16 million."</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The projected increase falls short by $</span><span class="sc">{</span><span class="dv">16_000_000</span> <span class="op">-</span> projected_increase<span class="sc">:,.2f}</span><span class="ss">."</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co">##Explanation</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Projected Revenue Before Increase (scaled): $2,100,000.00</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Projected Revenue After Increase (scaled): $3,500,000.00</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Projected Revenue Increase: $1,400,000.00</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co">#City Clerk's Claimed Revenue Increase: $16,000,000</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co">#The projected increase falls short by $14,600,000.00.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Projected Revenue Before Increase (scaled): $2,100,000.00
Projected Revenue After Increase (scaled): $3,500,000.00
Projected Revenue Increase: $1,400,000.00
City Clerk's Claimed Revenue Increase: $16,000,000
The projected increase falls short by $14,600,000.00.</code></pre>
</div>
</div>
<div id="f77f023b" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">##2.4</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import altair as alt</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure issue_date is in datetime format</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'issue_date'</span>] <span class="op">=</span> pd.to_datetime(tickets_data[<span class="st">'issue_date'</span>])</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two violation codes</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>old_code <span class="op">=</span> <span class="st">'0964125'</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>new_code <span class="op">=</span> <span class="st">'0964125B'</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'city_sticker_violation'</span>] <span class="op">=</span> tickets_data[<span class="st">'violation_code'</span>].isin([old_code, new_code])</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the price increase date</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>price_increase_date <span class="op">=</span> pd.Timestamp(<span class="st">'2012-02-24'</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Separate data into two periods: before and after the price increase</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>before_increase <span class="op">=</span> tickets_data[tickets_data[<span class="st">'issue_date'</span>] <span class="op">&lt;</span> price_increase_date]</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>after_increase <span class="op">=</span> tickets_data[tickets_data[<span class="st">'issue_date'</span>] <span class="op">&gt;=</span> price_increase_date]</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate repayment rates for each period</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>repayment_before <span class="op">=</span> before_increase[<span class="st">'city_sticker_violation'</span>].mean()  <span class="co"># Assuming binary (1 for payment, 0 for no payment)</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>repayment_after <span class="op">=</span> after_increase[<span class="st">'city_sticker_violation'</span>].mean()</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Calculate the number of tickets issued before and after the price increase</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>tickets_before <span class="op">=</span> before_increase[<span class="st">'city_sticker_violation'</span>].count()</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>tickets_after <span class="op">=</span> after_increase[<span class="st">'city_sticker_violation'</span>].count()</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the number of tickets issued after the price increase remains the same as before</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>tickets_after_assumed <span class="op">=</span> tickets_before</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Calculate revenue for both periods</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming each ticket has a fixed fine amount </span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>fine_amount <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>revenue_before <span class="op">=</span> repayment_before <span class="op">*</span> tickets_before <span class="op">*</span> fine_amount</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>revenue_after <span class="op">=</span> repayment_after <span class="op">*</span> tickets_after_assumed <span class="op">*</span> fine_amount</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Calculate the change in revenue</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>change_in_revenue <span class="op">=</span> revenue_after <span class="op">-</span> revenue_before</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Repayment Rate Before Price Increase: </span><span class="sc">{</span>repayment_before<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Repayment Rate After Price Increase: </span><span class="sc">{</span>repayment_after<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Revenue Before Price Increase: $</span><span class="sc">{</span>revenue_before<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Revenue After Price Increase (assuming unchanged ticket count): $</span><span class="sc">{</span>revenue_after<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Change in Revenue: $</span><span class="sc">{</span>change_in_revenue<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the number of tickets over time</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>df_monthly <span class="op">=</span> tickets_data.groupby(tickets_data[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)).size().reset_index(name<span class="op">=</span><span class="st">'ticket_count'</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>df_monthly[<span class="st">'issue_date'</span>] <span class="op">=</span> df_monthly[<span class="st">'issue_date'</span>].dt.to_timestamp()</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(df_monthly).mark_line().encode(</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'issue_date:T'</span>, axis<span class="op">=</span>alt.Axis(<span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>, labelAngle<span class="op">=-</span><span class="dv">45</span>)),  <span class="co"># Custom date format</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'ticket_count'</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Missing City Sticker Tickets Over Time'</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a vertical line to indicate the price increase date</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>rule <span class="op">=</span> alt.Chart(pd.DataFrame({<span class="st">'price_increase'</span>: [price_increase_date]})).mark_rule(color<span class="op">=</span><span class="st">'red'</span>).encode(</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'price_increase:T'</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the line chart and the rule</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>final_chart <span class="op">=</span> chart <span class="op">+</span> rule</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the chart</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>final_chart.display()</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="co">#Repayment Rate Before Price Increase: 7.76%</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="co">#Repayment Rate After Price Increase: 9.57%</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a><span class="co">#Revenue Before Price Increase: $2150800.00</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a><span class="co">#Revenue After Price Increase (assuming unchanged ticket count): $2651089.80</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="co">#Change in Revenue: $500289.80</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Repayment Rate Before Price Increase: 7.76%
Repayment Rate After Price Increase: 9.57%
Revenue Before Price Increase: $2150800.00
Revenue After Price Increase (assuming unchanged ticket count): $2651089.80
Change in Revenue: $500289.80</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-0b0f7fea2e5d4bd385e3e5e82a3f31be.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-0b0f7fea2e5d4bd385e3e5e82a3f31be.vega-embed details,
  #altair-viz-0b0f7fea2e5d4bd385e3e5e82a3f31be.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-0b0f7fea2e5d4bd385e3e5e82a3f31be"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0b0f7fea2e5d4bd385e3e5e82a3f31be") {
      outputDiv = document.getElementById("altair-viz-0b0f7fea2e5d4bd385e3e5e82a3f31be");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"data": {"name": "data-77675356b5fcaf4528429f9f55b6afce"}, "mark": {"type": "line"}, "encoding": {"x": {"axis": {"format": "%Y-%m", "labelAngle": -45}, "field": "issue_date", "type": "temporal"}, "y": {"field": "ticket_count", "type": "quantitative"}}, "title": "Missing City Sticker Tickets Over Time"}, {"data": {"name": "data-278e2198a3b1f5e4542a53a1b169b66d"}, "mark": {"type": "rule", "color": "red"}, "encoding": {"x": {"field": "price_increase", "type": "temporal"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-77675356b5fcaf4528429f9f55b6afce": [{"issue_date": "2007-01-01T00:00:00", "ticket_count": 2480}, {"issue_date": "2007-02-01T00:00:00", "ticket_count": 1824}, {"issue_date": "2007-03-01T00:00:00", "ticket_count": 2409}, {"issue_date": "2007-04-01T00:00:00", "ticket_count": 2553}, {"issue_date": "2007-05-01T00:00:00", "ticket_count": 2594}, {"issue_date": "2007-06-01T00:00:00", "ticket_count": 2431}, {"issue_date": "2007-07-01T00:00:00", "ticket_count": 2700}, {"issue_date": "2007-08-01T00:00:00", "ticket_count": 2729}, {"issue_date": "2007-09-01T00:00:00", "ticket_count": 2477}, {"issue_date": "2007-10-01T00:00:00", "ticket_count": 2675}, {"issue_date": "2007-11-01T00:00:00", "ticket_count": 2390}, {"issue_date": "2007-12-01T00:00:00", "ticket_count": 1990}, {"issue_date": "2008-01-01T00:00:00", "ticket_count": 2254}, {"issue_date": "2008-02-01T00:00:00", "ticket_count": 2444}, {"issue_date": "2008-03-01T00:00:00", "ticket_count": 2443}, {"issue_date": "2008-04-01T00:00:00", "ticket_count": 2652}, {"issue_date": "2008-05-01T00:00:00", "ticket_count": 2420}, {"issue_date": "2008-06-01T00:00:00", "ticket_count": 2347}, {"issue_date": "2008-07-01T00:00:00", "ticket_count": 2588}, {"issue_date": "2008-08-01T00:00:00", "ticket_count": 2528}, {"issue_date": "2008-09-01T00:00:00", "ticket_count": 2438}, {"issue_date": "2008-10-01T00:00:00", "ticket_count": 2588}, {"issue_date": "2008-11-01T00:00:00", "ticket_count": 2227}, {"issue_date": "2008-12-01T00:00:00", "ticket_count": 1784}, {"issue_date": "2009-01-01T00:00:00", "ticket_count": 2055}, {"issue_date": "2009-02-01T00:00:00", "ticket_count": 2027}, {"issue_date": "2009-03-01T00:00:00", "ticket_count": 2270}, {"issue_date": "2009-04-01T00:00:00", "ticket_count": 2724}, {"issue_date": "2009-05-01T00:00:00", "ticket_count": 2513}, {"issue_date": "2009-06-01T00:00:00", "ticket_count": 2402}, {"issue_date": "2009-07-01T00:00:00", "ticket_count": 2504}, {"issue_date": "2009-08-01T00:00:00", "ticket_count": 2393}, {"issue_date": "2009-09-01T00:00:00", "ticket_count": 2362}, {"issue_date": "2009-10-01T00:00:00", "ticket_count": 2340}, {"issue_date": "2009-11-01T00:00:00", "ticket_count": 2087}, {"issue_date": "2009-12-01T00:00:00", "ticket_count": 1658}, {"issue_date": "2010-01-01T00:00:00", "ticket_count": 1934}, {"issue_date": "2010-02-01T00:00:00", "ticket_count": 1693}, {"issue_date": "2010-03-01T00:00:00", "ticket_count": 2008}, {"issue_date": "2010-04-01T00:00:00", "ticket_count": 2099}, {"issue_date": "2010-05-01T00:00:00", "ticket_count": 2157}, {"issue_date": "2010-06-01T00:00:00", "ticket_count": 2152}, {"issue_date": "2010-07-01T00:00:00", "ticket_count": 1986}, {"issue_date": "2010-08-01T00:00:00", "ticket_count": 2485}, {"issue_date": "2010-09-01T00:00:00", "ticket_count": 2441}, {"issue_date": "2010-10-01T00:00:00", "ticket_count": 2388}, {"issue_date": "2010-11-01T00:00:00", "ticket_count": 2194}, {"issue_date": "2010-12-01T00:00:00", "ticket_count": 1787}, {"issue_date": "2011-01-01T00:00:00", "ticket_count": 1968}, {"issue_date": "2011-02-01T00:00:00", "ticket_count": 1380}, {"issue_date": "2011-03-01T00:00:00", "ticket_count": 2102}, {"issue_date": "2011-04-01T00:00:00", "ticket_count": 2257}, {"issue_date": "2011-05-01T00:00:00", "ticket_count": 2208}, {"issue_date": "2011-06-01T00:00:00", "ticket_count": 2298}, {"issue_date": "2011-07-01T00:00:00", "ticket_count": 2355}, {"issue_date": "2011-08-01T00:00:00", "ticket_count": 2347}, {"issue_date": "2011-09-01T00:00:00", "ticket_count": 2113}, {"issue_date": "2011-10-01T00:00:00", "ticket_count": 2141}, {"issue_date": "2011-11-01T00:00:00", "ticket_count": 1966}, {"issue_date": "2011-12-01T00:00:00", "ticket_count": 1763}, {"issue_date": "2012-01-01T00:00:00", "ticket_count": 1676}, {"issue_date": "2012-02-01T00:00:00", "ticket_count": 1797}, {"issue_date": "2012-03-01T00:00:00", "ticket_count": 1898}, {"issue_date": "2012-04-01T00:00:00", "ticket_count": 2054}, {"issue_date": "2012-05-01T00:00:00", "ticket_count": 1995}, {"issue_date": "2012-06-01T00:00:00", "ticket_count": 2156}, {"issue_date": "2012-07-01T00:00:00", "ticket_count": 2305}, {"issue_date": "2012-08-01T00:00:00", "ticket_count": 2368}, {"issue_date": "2012-09-01T00:00:00", "ticket_count": 2061}, {"issue_date": "2012-10-01T00:00:00", "ticket_count": 2274}, {"issue_date": "2012-11-01T00:00:00", "ticket_count": 2023}, {"issue_date": "2012-12-01T00:00:00", "ticket_count": 1799}, {"issue_date": "2013-01-01T00:00:00", "ticket_count": 2117}, {"issue_date": "2013-02-01T00:00:00", "ticket_count": 1717}, {"issue_date": "2013-03-01T00:00:00", "ticket_count": 2102}, {"issue_date": "2013-04-01T00:00:00", "ticket_count": 2383}, {"issue_date": "2013-05-01T00:00:00", "ticket_count": 2260}, {"issue_date": "2013-06-01T00:00:00", "ticket_count": 2133}, {"issue_date": "2013-07-01T00:00:00", "ticket_count": 2543}, {"issue_date": "2013-08-01T00:00:00", "ticket_count": 2496}, {"issue_date": "2013-09-01T00:00:00", "ticket_count": 2191}, {"issue_date": "2013-10-01T00:00:00", "ticket_count": 2311}, {"issue_date": "2013-11-01T00:00:00", "ticket_count": 1997}, {"issue_date": "2013-12-01T00:00:00", "ticket_count": 1733}, {"issue_date": "2014-01-01T00:00:00", "ticket_count": 1732}, {"issue_date": "2014-02-01T00:00:00", "ticket_count": 1785}, {"issue_date": "2014-03-01T00:00:00", "ticket_count": 2136}, {"issue_date": "2014-04-01T00:00:00", "ticket_count": 2372}, {"issue_date": "2014-05-01T00:00:00", "ticket_count": 2244}, {"issue_date": "2014-06-01T00:00:00", "ticket_count": 2169}, {"issue_date": "2014-07-01T00:00:00", "ticket_count": 2184}, {"issue_date": "2014-08-01T00:00:00", "ticket_count": 2145}, {"issue_date": "2014-09-01T00:00:00", "ticket_count": 2100}, {"issue_date": "2014-10-01T00:00:00", "ticket_count": 2170}, {"issue_date": "2014-11-01T00:00:00", "ticket_count": 1795}, {"issue_date": "2014-12-01T00:00:00", "ticket_count": 1720}, {"issue_date": "2015-01-01T00:00:00", "ticket_count": 1786}, {"issue_date": "2015-02-01T00:00:00", "ticket_count": 1378}, {"issue_date": "2015-03-01T00:00:00", "ticket_count": 1929}, {"issue_date": "2015-04-01T00:00:00", "ticket_count": 2145}, {"issue_date": "2015-05-01T00:00:00", "ticket_count": 2134}, {"issue_date": "2015-06-01T00:00:00", "ticket_count": 2251}, {"issue_date": "2015-07-01T00:00:00", "ticket_count": 2279}, {"issue_date": "2015-08-01T00:00:00", "ticket_count": 2197}, {"issue_date": "2015-09-01T00:00:00", "ticket_count": 2182}, {"issue_date": "2015-10-01T00:00:00", "ticket_count": 2222}, {"issue_date": "2015-11-01T00:00:00", "ticket_count": 1935}, {"issue_date": "2015-12-01T00:00:00", "ticket_count": 1789}, {"issue_date": "2016-01-01T00:00:00", "ticket_count": 1773}, {"issue_date": "2016-02-01T00:00:00", "ticket_count": 1609}, {"issue_date": "2016-03-01T00:00:00", "ticket_count": 1793}, {"issue_date": "2016-04-01T00:00:00", "ticket_count": 2097}, {"issue_date": "2016-05-01T00:00:00", "ticket_count": 2059}, {"issue_date": "2016-06-01T00:00:00", "ticket_count": 2013}, {"issue_date": "2016-07-01T00:00:00", "ticket_count": 1865}, {"issue_date": "2016-08-01T00:00:00", "ticket_count": 2037}, {"issue_date": "2016-09-01T00:00:00", "ticket_count": 1901}, {"issue_date": "2016-10-01T00:00:00", "ticket_count": 2089}, {"issue_date": "2016-11-01T00:00:00", "ticket_count": 1883}, {"issue_date": "2016-12-01T00:00:00", "ticket_count": 1524}, {"issue_date": "2017-01-01T00:00:00", "ticket_count": 1865}, {"issue_date": "2017-02-01T00:00:00", "ticket_count": 1604}, {"issue_date": "2017-03-01T00:00:00", "ticket_count": 1770}, {"issue_date": "2017-04-01T00:00:00", "ticket_count": 1925}, {"issue_date": "2017-05-01T00:00:00", "ticket_count": 2010}, {"issue_date": "2017-06-01T00:00:00", "ticket_count": 1995}, {"issue_date": "2017-07-01T00:00:00", "ticket_count": 1975}, {"issue_date": "2017-08-01T00:00:00", "ticket_count": 1993}, {"issue_date": "2017-09-01T00:00:00", "ticket_count": 2015}, {"issue_date": "2017-10-01T00:00:00", "ticket_count": 1952}, {"issue_date": "2017-11-01T00:00:00", "ticket_count": 1816}, {"issue_date": "2017-12-01T00:00:00", "ticket_count": 1444}, {"issue_date": "2018-01-01T00:00:00", "ticket_count": 1675}, {"issue_date": "2018-02-01T00:00:00", "ticket_count": 1384}, {"issue_date": "2018-03-01T00:00:00", "ticket_count": 1865}, {"issue_date": "2018-04-01T00:00:00", "ticket_count": 1996}, {"issue_date": "2018-05-01T00:00:00", "ticket_count": 841}], "data-278e2198a3b1f5e4542a53a1b169b66d": [{"price_increase": "2012-02-24T00:00:00"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="f66edead" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">##2.5</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import altair as alt</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure issue_date is in datetime format</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'issue_date'</span>] <span class="op">=</span> pd.to_datetime(tickets_data[<span class="st">'issue_date'</span>])</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two violation codes</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>old_code <span class="op">=</span> <span class="st">'0964125'</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>new_code <span class="op">=</span> <span class="st">'0964125B'</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'city_sticker_violation'</span>] <span class="op">=</span> tickets_data[<span class="st">'violation_code'</span>].isin([old_code, new_code])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the price increase date (policy introduction date)</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>price_increase_date <span class="op">=</span> pd.Timestamp(<span class="st">'2012-02-24'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Calculate repayment rates by month</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>tickets_data[<span class="st">'paid'</span>] <span class="op">=</span> tickets_data[<span class="st">'city_sticker_violation'</span>].astype(<span class="bu">int</span>)  <span class="co"># Assuming 1 for payment, 0 for non-payment</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouping by month to calculate repayment rates</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>monthly_data <span class="op">=</span> tickets_data.groupby(tickets_data[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)).agg(</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'city_sticker_violation'</span>, <span class="st">'size'</span>),</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    total_paid<span class="op">=</span>(<span class="st">'paid'</span>, <span class="st">'sum'</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate repayment rate</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>monthly_data[<span class="st">'repayment_rate'</span>] <span class="op">=</span> monthly_data[<span class="st">'total_paid'</span>] <span class="op">/</span> monthly_data[<span class="st">'total_tickets'</span>]</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'month' Period objects to string format for Altair compatibility</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>monthly_data[<span class="st">'issue_date'</span>] <span class="op">=</span> monthly_data[<span class="st">'issue_date'</span>].dt.to_timestamp()</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Plot repayment rates over time</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(monthly_data).mark_line(point<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'issue_date:T'</span>, title<span class="op">=</span><span class="st">'Month'</span>, axis<span class="op">=</span>alt.Axis(<span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>, labelAngle<span class="op">=-</span><span class="dv">45</span>)),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>, scale<span class="op">=</span>alt.Scale(domain<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>])),</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'issue_date:T'</span>, <span class="st">'repayment_rate:Q'</span>]</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Repayment Rates for Missing City Sticker Tickets Over Time'</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a vertical line to indicate the price increase date</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>rule <span class="op">=</span> alt.Chart(pd.DataFrame({<span class="st">'price_increase'</span>: [price_increase_date]})).mark_rule(color<span class="op">=</span><span class="st">'red'</span>).encode(</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'price_increase:T'</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the line chart and the rule</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>final_chart <span class="op">=</span> chart <span class="op">+</span> rule</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply configurations to the LayerChart</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>final_chart <span class="op">=</span> final_chart.configure_axis(</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    grid<span class="op">=</span><span class="va">True</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>).configure_view(</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    stroke<span class="op">=</span><span class="st">'transparent'</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the chart</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>final_chart.display()</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretation</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>repayment_rate_mean_before <span class="op">=</span> monthly_data[monthly_data[<span class="st">'issue_date'</span>] <span class="op">&lt;</span> price_increase_date][<span class="st">'repayment_rate'</span>].mean()</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>repayment_rate_mean_after <span class="op">=</span> monthly_data[monthly_data[<span class="st">'issue_date'</span>] <span class="op">&gt;=</span> price_increase_date][<span class="st">'repayment_rate'</span>].mean()</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Repayment Rate Before Price Increase: </span><span class="sc">{</span>repayment_rate_mean_before<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Repayment Rate After Price Increase: </span><span class="sc">{</span>repayment_rate_mean_after<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="co">#The graph shows that average repayment rate significantly drops after the price increase</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-45ba43637181480baa9620e4b6ce3d4c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-45ba43637181480baa9620e4b6ce3d4c.vega-embed details,
  #altair-viz-45ba43637181480baa9620e4b6ce3d4c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-45ba43637181480baa9620e4b6ce3d4c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-45ba43637181480baa9620e4b6ce3d4c") {
      outputDiv = document.getElementById("altair-viz-45ba43637181480baa9620e4b6ce3d4c");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300, "stroke": "transparent"}, "axis": {"grid": true}}, "layer": [{"data": {"name": "data-fd30491d871ddc957730904298cb6317"}, "mark": {"type": "line", "point": true}, "encoding": {"tooltip": [{"field": "issue_date", "type": "temporal"}, {"field": "repayment_rate", "type": "quantitative"}], "x": {"axis": {"format": "%Y-%m", "labelAngle": -45}, "field": "issue_date", "title": "Month", "type": "temporal"}, "y": {"field": "repayment_rate", "scale": {"domain": [0, 1]}, "title": "Repayment Rate", "type": "quantitative"}}, "title": "Repayment Rates for Missing City Sticker Tickets Over Time"}, {"data": {"name": "data-278e2198a3b1f5e4542a53a1b169b66d"}, "mark": {"type": "rule", "color": "red"}, "encoding": {"x": {"field": "price_increase", "type": "temporal"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-fd30491d871ddc957730904298cb6317": [{"issue_date": "2007-01-01T00:00:00", "total_tickets": 2480, "total_paid": 160, "repayment_rate": 0.06451612903225806}, {"issue_date": "2007-02-01T00:00:00", "total_tickets": 1824, "total_paid": 104, "repayment_rate": 0.05701754385964912}, {"issue_date": "2007-03-01T00:00:00", "total_tickets": 2409, "total_paid": 161, "repayment_rate": 0.0668327106683271}, {"issue_date": "2007-04-01T00:00:00", "total_tickets": 2553, "total_paid": 158, "repayment_rate": 0.06188797493145319}, {"issue_date": "2007-05-01T00:00:00", "total_tickets": 2594, "total_paid": 126, "repayment_rate": 0.04857363145720894}, {"issue_date": "2007-06-01T00:00:00", "total_tickets": 2431, "total_paid": 80, "repayment_rate": 0.03290826820238585}, {"issue_date": "2007-07-01T00:00:00", "total_tickets": 2700, "total_paid": 399, "repayment_rate": 0.14777777777777779}, {"issue_date": "2007-08-01T00:00:00", "total_tickets": 2729, "total_paid": 345, "repayment_rate": 0.12641993404177354}, {"issue_date": "2007-09-01T00:00:00", "total_tickets": 2477, "total_paid": 224, "repayment_rate": 0.0904319741622931}, {"issue_date": "2007-10-01T00:00:00", "total_tickets": 2675, "total_paid": 221, "repayment_rate": 0.08261682242990655}, {"issue_date": "2007-11-01T00:00:00", "total_tickets": 2390, "total_paid": 168, "repayment_rate": 0.07029288702928871}, {"issue_date": "2007-12-01T00:00:00", "total_tickets": 1990, "total_paid": 118, "repayment_rate": 0.0592964824120603}, {"issue_date": "2008-01-01T00:00:00", "total_tickets": 2254, "total_paid": 132, "repayment_rate": 0.05856255545696539}, {"issue_date": "2008-02-01T00:00:00", "total_tickets": 2444, "total_paid": 149, "repayment_rate": 0.06096563011456629}, {"issue_date": "2008-03-01T00:00:00", "total_tickets": 2443, "total_paid": 192, "repayment_rate": 0.07859189521080638}, {"issue_date": "2008-04-01T00:00:00", "total_tickets": 2652, "total_paid": 166, "repayment_rate": 0.06259426847662142}, {"issue_date": "2008-05-01T00:00:00", "total_tickets": 2420, "total_paid": 139, "repayment_rate": 0.05743801652892562}, {"issue_date": "2008-06-01T00:00:00", "total_tickets": 2347, "total_paid": 72, "repayment_rate": 0.03067746058798466}, {"issue_date": "2008-07-01T00:00:00", "total_tickets": 2588, "total_paid": 382, "repayment_rate": 0.14760432766615147}, {"issue_date": "2008-08-01T00:00:00", "total_tickets": 2528, "total_paid": 342, "repayment_rate": 0.13528481012658228}, {"issue_date": "2008-09-01T00:00:00", "total_tickets": 2438, "total_paid": 213, "repayment_rate": 0.08736669401148482}, {"issue_date": "2008-10-01T00:00:00", "total_tickets": 2588, "total_paid": 197, "repayment_rate": 0.07612055641421947}, {"issue_date": "2008-11-01T00:00:00", "total_tickets": 2227, "total_paid": 148, "repayment_rate": 0.06645711719802425}, {"issue_date": "2008-12-01T00:00:00", "total_tickets": 1784, "total_paid": 80, "repayment_rate": 0.04484304932735426}, {"issue_date": "2009-01-01T00:00:00", "total_tickets": 2055, "total_paid": 81, "repayment_rate": 0.03941605839416058}, {"issue_date": "2009-02-01T00:00:00", "total_tickets": 2027, "total_paid": 121, "repayment_rate": 0.05969412925505673}, {"issue_date": "2009-03-01T00:00:00", "total_tickets": 2270, "total_paid": 171, "repayment_rate": 0.07533039647577093}, {"issue_date": "2009-04-01T00:00:00", "total_tickets": 2724, "total_paid": 149, "repayment_rate": 0.05469897209985316}, {"issue_date": "2009-05-01T00:00:00", "total_tickets": 2513, "total_paid": 132, "repayment_rate": 0.05252686032630322}, {"issue_date": "2009-06-01T00:00:00", "total_tickets": 2402, "total_paid": 89, "repayment_rate": 0.037052456286427976}, {"issue_date": "2009-07-01T00:00:00", "total_tickets": 2504, "total_paid": 392, "repayment_rate": 0.15654952076677317}, {"issue_date": "2009-08-01T00:00:00", "total_tickets": 2393, "total_paid": 347, "repayment_rate": 0.1450062682824906}, {"issue_date": "2009-09-01T00:00:00", "total_tickets": 2362, "total_paid": 211, "repayment_rate": 0.08933107535986452}, {"issue_date": "2009-10-01T00:00:00", "total_tickets": 2340, "total_paid": 188, "repayment_rate": 0.08034188034188035}, {"issue_date": "2009-11-01T00:00:00", "total_tickets": 2087, "total_paid": 170, "repayment_rate": 0.08145663632007666}, {"issue_date": "2009-12-01T00:00:00", "total_tickets": 1658, "total_paid": 98, "repayment_rate": 0.05910735826296743}, {"issue_date": "2010-01-01T00:00:00", "total_tickets": 1934, "total_paid": 156, "repayment_rate": 0.08066184074457083}, {"issue_date": "2010-02-01T00:00:00", "total_tickets": 1693, "total_paid": 129, "repayment_rate": 0.07619610159480213}, {"issue_date": "2010-03-01T00:00:00", "total_tickets": 2008, "total_paid": 153, "repayment_rate": 0.07619521912350598}, {"issue_date": "2010-04-01T00:00:00", "total_tickets": 2099, "total_paid": 138, "repayment_rate": 0.06574559313959027}, {"issue_date": "2010-05-01T00:00:00", "total_tickets": 2157, "total_paid": 140, "repayment_rate": 0.06490496059341679}, {"issue_date": "2010-06-01T00:00:00", "total_tickets": 2152, "total_paid": 99, "repayment_rate": 0.04600371747211896}, {"issue_date": "2010-07-01T00:00:00", "total_tickets": 1986, "total_paid": 26, "repayment_rate": 0.013091641490433032}, {"issue_date": "2010-08-01T00:00:00", "total_tickets": 2485, "total_paid": 425, "repayment_rate": 0.1710261569416499}, {"issue_date": "2010-09-01T00:00:00", "total_tickets": 2441, "total_paid": 237, "repayment_rate": 0.09709135600163868}, {"issue_date": "2010-10-01T00:00:00", "total_tickets": 2388, "total_paid": 197, "repayment_rate": 0.08249581239530988}, {"issue_date": "2010-11-01T00:00:00", "total_tickets": 2194, "total_paid": 168, "repayment_rate": 0.07657247037374658}, {"issue_date": "2010-12-01T00:00:00", "total_tickets": 1787, "total_paid": 117, "repayment_rate": 0.06547285954113038}, {"issue_date": "2011-01-01T00:00:00", "total_tickets": 1968, "total_paid": 153, "repayment_rate": 0.07774390243902439}, {"issue_date": "2011-02-01T00:00:00", "total_tickets": 1380, "total_paid": 87, "repayment_rate": 0.06304347826086956}, {"issue_date": "2011-03-01T00:00:00", "total_tickets": 2102, "total_paid": 147, "repayment_rate": 0.06993339676498572}, {"issue_date": "2011-04-01T00:00:00", "total_tickets": 2257, "total_paid": 135, "repayment_rate": 0.05981391227292867}, {"issue_date": "2011-05-01T00:00:00", "total_tickets": 2208, "total_paid": 134, "repayment_rate": 0.06068840579710145}, {"issue_date": "2011-06-01T00:00:00", "total_tickets": 2298, "total_paid": 78, "repayment_rate": 0.033942558746736295}, {"issue_date": "2011-07-01T00:00:00", "total_tickets": 2355, "total_paid": 317, "repayment_rate": 0.1346072186836518}, {"issue_date": "2011-08-01T00:00:00", "total_tickets": 2347, "total_paid": 313, "repayment_rate": 0.13336173838943333}, {"issue_date": "2011-09-01T00:00:00", "total_tickets": 2113, "total_paid": 171, "repayment_rate": 0.08092759110269758}, {"issue_date": "2011-10-01T00:00:00", "total_tickets": 2141, "total_paid": 136, "repayment_rate": 0.06352171882297991}, {"issue_date": "2011-11-01T00:00:00", "total_tickets": 1966, "total_paid": 139, "repayment_rate": 0.07070193285859613}, {"issue_date": "2011-12-01T00:00:00", "total_tickets": 1763, "total_paid": 123, "repayment_rate": 0.06976744186046512}, {"issue_date": "2012-01-01T00:00:00", "total_tickets": 1676, "total_paid": 114, "repayment_rate": 0.06801909307875895}, {"issue_date": "2012-02-01T00:00:00", "total_tickets": 1797, "total_paid": 138, "repayment_rate": 0.07679465776293823}, {"issue_date": "2012-03-01T00:00:00", "total_tickets": 1898, "total_paid": 181, "repayment_rate": 0.09536354056902002}, {"issue_date": "2012-04-01T00:00:00", "total_tickets": 2054, "total_paid": 142, "repayment_rate": 0.0691333982473223}, {"issue_date": "2012-05-01T00:00:00", "total_tickets": 1995, "total_paid": 115, "repayment_rate": 0.05764411027568922}, {"issue_date": "2012-06-01T00:00:00", "total_tickets": 2156, "total_paid": 100, "repayment_rate": 0.04638218923933209}, {"issue_date": "2012-07-01T00:00:00", "total_tickets": 2305, "total_paid": 414, "repayment_rate": 0.17960954446854663}, {"issue_date": "2012-08-01T00:00:00", "total_tickets": 2368, "total_paid": 319, "repayment_rate": 0.13471283783783783}, {"issue_date": "2012-09-01T00:00:00", "total_tickets": 2061, "total_paid": 179, "repayment_rate": 0.08685104318292092}, {"issue_date": "2012-10-01T00:00:00", "total_tickets": 2274, "total_paid": 171, "repayment_rate": 0.07519788918205805}, {"issue_date": "2012-11-01T00:00:00", "total_tickets": 2023, "total_paid": 157, "repayment_rate": 0.07760751359367277}, {"issue_date": "2012-12-01T00:00:00", "total_tickets": 1799, "total_paid": 162, "repayment_rate": 0.09005002779321845}, {"issue_date": "2013-01-01T00:00:00", "total_tickets": 2117, "total_paid": 196, "repayment_rate": 0.09258384506376949}, {"issue_date": "2013-02-01T00:00:00", "total_tickets": 1717, "total_paid": 158, "repayment_rate": 0.09202096680256261}, {"issue_date": "2013-03-01T00:00:00", "total_tickets": 2102, "total_paid": 199, "repayment_rate": 0.09467174119885823}, {"issue_date": "2013-04-01T00:00:00", "total_tickets": 2383, "total_paid": 187, "repayment_rate": 0.07847251363827108}, {"issue_date": "2013-05-01T00:00:00", "total_tickets": 2260, "total_paid": 179, "repayment_rate": 0.07920353982300884}, {"issue_date": "2013-06-01T00:00:00", "total_tickets": 2133, "total_paid": 140, "repayment_rate": 0.06563525550867323}, {"issue_date": "2013-07-01T00:00:00", "total_tickets": 2543, "total_paid": 499, "repayment_rate": 0.19622493118364137}, {"issue_date": "2013-08-01T00:00:00", "total_tickets": 2496, "total_paid": 355, "repayment_rate": 0.1422275641025641}, {"issue_date": "2013-09-01T00:00:00", "total_tickets": 2191, "total_paid": 221, "repayment_rate": 0.10086718393427659}, {"issue_date": "2013-10-01T00:00:00", "total_tickets": 2311, "total_paid": 208, "repayment_rate": 0.09000432713111207}, {"issue_date": "2013-11-01T00:00:00", "total_tickets": 1997, "total_paid": 127, "repayment_rate": 0.06359539308963445}, {"issue_date": "2013-12-01T00:00:00", "total_tickets": 1733, "total_paid": 98, "repayment_rate": 0.05654933641084824}, {"issue_date": "2014-01-01T00:00:00", "total_tickets": 1732, "total_paid": 100, "repayment_rate": 0.057736720554272515}, {"issue_date": "2014-02-01T00:00:00", "total_tickets": 1785, "total_paid": 147, "repayment_rate": 0.08235294117647059}, {"issue_date": "2014-03-01T00:00:00", "total_tickets": 2136, "total_paid": 155, "repayment_rate": 0.07256554307116105}, {"issue_date": "2014-04-01T00:00:00", "total_tickets": 2372, "total_paid": 144, "repayment_rate": 0.06070826306913996}, {"issue_date": "2014-05-01T00:00:00", "total_tickets": 2244, "total_paid": 178, "repayment_rate": 0.07932263814616755}, {"issue_date": "2014-06-01T00:00:00", "total_tickets": 2169, "total_paid": 116, "repayment_rate": 0.053480866758875055}, {"issue_date": "2014-07-01T00:00:00", "total_tickets": 2184, "total_paid": 267, "repayment_rate": 0.12225274725274725}, {"issue_date": "2014-08-01T00:00:00", "total_tickets": 2145, "total_paid": 245, "repayment_rate": 0.11421911421911422}, {"issue_date": "2014-09-01T00:00:00", "total_tickets": 2100, "total_paid": 178, "repayment_rate": 0.08476190476190476}, {"issue_date": "2014-10-01T00:00:00", "total_tickets": 2170, "total_paid": 165, "repayment_rate": 0.07603686635944701}, {"issue_date": "2014-11-01T00:00:00", "total_tickets": 1795, "total_paid": 153, "repayment_rate": 0.08523676880222841}, {"issue_date": "2014-12-01T00:00:00", "total_tickets": 1720, "total_paid": 177, "repayment_rate": 0.10290697674418604}, {"issue_date": "2015-01-01T00:00:00", "total_tickets": 1786, "total_paid": 179, "repayment_rate": 0.10022396416573348}, {"issue_date": "2015-02-01T00:00:00", "total_tickets": 1378, "total_paid": 142, "repayment_rate": 0.10304789550072568}, {"issue_date": "2015-03-01T00:00:00", "total_tickets": 1929, "total_paid": 223, "repayment_rate": 0.11560393986521514}, {"issue_date": "2015-04-01T00:00:00", "total_tickets": 2145, "total_paid": 191, "repayment_rate": 0.08904428904428904}, {"issue_date": "2015-05-01T00:00:00", "total_tickets": 2134, "total_paid": 191, "repayment_rate": 0.0895032802249297}, {"issue_date": "2015-06-01T00:00:00", "total_tickets": 2251, "total_paid": 198, "repayment_rate": 0.08796090626388271}, {"issue_date": "2015-07-01T00:00:00", "total_tickets": 2279, "total_paid": 217, "repayment_rate": 0.09521720052654672}, {"issue_date": "2015-08-01T00:00:00", "total_tickets": 2197, "total_paid": 210, "repayment_rate": 0.09558488848429676}, {"issue_date": "2015-09-01T00:00:00", "total_tickets": 2182, "total_paid": 225, "repayment_rate": 0.10311640696608616}, {"issue_date": "2015-10-01T00:00:00", "total_tickets": 2222, "total_paid": 245, "repayment_rate": 0.11026102610261027}, {"issue_date": "2015-11-01T00:00:00", "total_tickets": 1935, "total_paid": 226, "repayment_rate": 0.11679586563307494}, {"issue_date": "2015-12-01T00:00:00", "total_tickets": 1789, "total_paid": 220, "repayment_rate": 0.12297372833985466}, {"issue_date": "2016-01-01T00:00:00", "total_tickets": 1773, "total_paid": 202, "repayment_rate": 0.11393119007332206}, {"issue_date": "2016-02-01T00:00:00", "total_tickets": 1609, "total_paid": 206, "repayment_rate": 0.12802983219390926}, {"issue_date": "2016-03-01T00:00:00", "total_tickets": 1793, "total_paid": 241, "repayment_rate": 0.13441160066926938}, {"issue_date": "2016-04-01T00:00:00", "total_tickets": 2097, "total_paid": 203, "repayment_rate": 0.09680495946590367}, {"issue_date": "2016-05-01T00:00:00", "total_tickets": 2059, "total_paid": 185, "repayment_rate": 0.08984944147644487}, {"issue_date": "2016-06-01T00:00:00", "total_tickets": 2013, "total_paid": 175, "repayment_rate": 0.08693492300049677}, {"issue_date": "2016-07-01T00:00:00", "total_tickets": 1865, "total_paid": 160, "repayment_rate": 0.08579088471849866}, {"issue_date": "2016-08-01T00:00:00", "total_tickets": 2037, "total_paid": 151, "repayment_rate": 0.0741286205203731}, {"issue_date": "2016-09-01T00:00:00", "total_tickets": 1901, "total_paid": 183, "repayment_rate": 0.09626512361914781}, {"issue_date": "2016-10-01T00:00:00", "total_tickets": 2089, "total_paid": 220, "repayment_rate": 0.10531354715174725}, {"issue_date": "2016-11-01T00:00:00", "total_tickets": 1883, "total_paid": 182, "repayment_rate": 0.09665427509293681}, {"issue_date": "2016-12-01T00:00:00", "total_tickets": 1524, "total_paid": 156, "repayment_rate": 0.10236220472440945}, {"issue_date": "2017-01-01T00:00:00", "total_tickets": 1865, "total_paid": 238, "repayment_rate": 0.12761394101876675}, {"issue_date": "2017-02-01T00:00:00", "total_tickets": 1604, "total_paid": 190, "repayment_rate": 0.11845386533665836}, {"issue_date": "2017-03-01T00:00:00", "total_tickets": 1770, "total_paid": 211, "repayment_rate": 0.1192090395480226}, {"issue_date": "2017-04-01T00:00:00", "total_tickets": 1925, "total_paid": 191, "repayment_rate": 0.09922077922077922}, {"issue_date": "2017-05-01T00:00:00", "total_tickets": 2010, "total_paid": 192, "repayment_rate": 0.0955223880597015}, {"issue_date": "2017-06-01T00:00:00", "total_tickets": 1995, "total_paid": 177, "repayment_rate": 0.0887218045112782}, {"issue_date": "2017-07-01T00:00:00", "total_tickets": 1975, "total_paid": 166, "repayment_rate": 0.0840506329113924}, {"issue_date": "2017-08-01T00:00:00", "total_tickets": 1993, "total_paid": 173, "repayment_rate": 0.0868038133467135}, {"issue_date": "2017-09-01T00:00:00", "total_tickets": 2015, "total_paid": 188, "repayment_rate": 0.09330024813895782}, {"issue_date": "2017-10-01T00:00:00", "total_tickets": 1952, "total_paid": 169, "repayment_rate": 0.08657786885245902}, {"issue_date": "2017-11-01T00:00:00", "total_tickets": 1816, "total_paid": 202, "repayment_rate": 0.11123348017621146}, {"issue_date": "2017-12-01T00:00:00", "total_tickets": 1444, "total_paid": 159, "repayment_rate": 0.11011080332409973}, {"issue_date": "2018-01-01T00:00:00", "total_tickets": 1675, "total_paid": 168, "repayment_rate": 0.10029850746268656}, {"issue_date": "2018-02-01T00:00:00", "total_tickets": 1384, "total_paid": 119, "repayment_rate": 0.08598265895953758}, {"issue_date": "2018-03-01T00:00:00", "total_tickets": 1865, "total_paid": 171, "repayment_rate": 0.09168900804289544}, {"issue_date": "2018-04-01T00:00:00", "total_tickets": 1996, "total_paid": 153, "repayment_rate": 0.07665330661322645}, {"issue_date": "2018-05-01T00:00:00", "total_tickets": 841, "total_paid": 79, "repayment_rate": 0.093935790725327}], "data-278e2198a3b1f5e4542a53a1b169b66d": [{"price_increase": "2012-02-24T00:00:00"}]}}, {"mode": "vega-lite"});
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Repayment Rate Before Price Increase: 7.62%
Average Repayment Rate After Price Increase: 9.55%</code></pre>
</div>
</div>
<div id="1202815d" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">##The violation types whose prices they should increase should be the ones that are occuring with the highest average frequency AND positive repayment rates, compared to the rest. This includes: "Expired plates or temporary", "Street Cleaning" and "Residential permit parking". </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#import altair as alt</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by violation description to get the total tickets and the number of paid tickets</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>violation_summary <span class="op">=</span> tickets_data.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="st">'size'</span>),  <span class="co"># Total number of tickets</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    total_paid<span class="op">=</span>(<span class="st">'paid'</span>, <span class="st">'sum'</span>)  <span class="co"># Number of paid tickets</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the repayment rate by dividing the number of paid tickets by the total tickets</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>violation_summary[<span class="st">'repayment_rate'</span>] <span class="op">=</span> violation_summary[<span class="st">'total_paid'</span>] <span class="op">/</span> violation_summary[<span class="st">'total_tickets'</span>]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Filter for violations with high ticket counts and repayment rates</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># To focus on revenue, we sort by total tickets and repayment rates and select the top three violations</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>top_violations <span class="op">=</span> violation_summary.sort_values(by<span class="op">=</span>[<span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>], ascending<span class="op">=</span>[<span class="va">False</span>, <span class="va">False</span>]).head(<span class="dv">3</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create a bar chart to visualize the total tickets and repayment rates</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> alt.Chart(top_violations).mark_bar().encode(</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'violation_description:N'</span>, title<span class="op">=</span><span class="st">'Violation Type'</span>, sort<span class="op">=</span><span class="st">'-y'</span>),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'total_tickets:Q'</span>, title<span class="op">=</span><span class="st">'Number of Tickets'</span>),</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description'</span>, <span class="st">'total_tickets'</span>]</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Top 3 Violation Types by Number of Tickets'</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Create a line chart to visualize the repayment rates of these top violations</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> alt.Chart(top_violations).mark_line(color<span class="op">=</span><span class="st">'red'</span>, point<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'violation_description:N'</span>, title<span class="op">=</span><span class="st">'Violation Type'</span>, sort<span class="op">=</span><span class="st">'-y'</span>),</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>, axis<span class="op">=</span>alt.Axis(<span class="bu">format</span><span class="op">=</span><span class="st">'%'</span>)),</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description'</span>, <span class="st">'repayment_rate'</span>]</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Combine the bar and line charts</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>final_chart <span class="op">=</span> alt.layer(bars, line).resolve_scale(</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'independent'</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Top 3 Violation Types by Ticket Count and Repayment Rate'</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the chart</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>final_chart.display()</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the top 3 violations with ticket counts and repayment rates</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 3 Violation Types with Ticket Counts and Repayment Rates:"</span>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_violations[[<span class="st">'violation_description'</span>, <span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-2063a70ae3be4ae4877b4e634ba0f154.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-2063a70ae3be4ae4877b4e634ba0f154.vega-embed details,
  #altair-viz-2063a70ae3be4ae4877b4e634ba0f154.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-2063a70ae3be4ae4877b4e634ba0f154"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-2063a70ae3be4ae4877b4e634ba0f154") {
      outputDiv = document.getElementById("altair-viz-2063a70ae3be4ae4877b4e634ba0f154");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "bar"}, "encoding": {"tooltip": [{"field": "violation_description", "type": "nominal"}, {"field": "total_tickets", "type": "quantitative"}], "x": {"field": "violation_description", "sort": "-y", "title": "Violation Type", "type": "nominal"}, "y": {"field": "total_tickets", "title": "Number of Tickets", "type": "quantitative"}}, "title": "Top 3 Violation Types by Number of Tickets"}, {"mark": {"type": "line", "color": "red", "point": true}, "encoding": {"tooltip": [{"field": "violation_description", "type": "nominal"}, {"field": "repayment_rate", "type": "quantitative"}], "x": {"field": "violation_description", "sort": "-y", "title": "Violation Type", "type": "nominal"}, "y": {"axis": {"format": "%"}, "field": "repayment_rate", "title": "Repayment Rate", "type": "quantitative"}}}], "data": {"name": "data-34ddc63fcebf3fe9696ed94aeab4355f"}, "resolve": {"scale": {"y": "independent"}}, "title": "Top 3 Violation Types by Ticket Count and Repayment Rate", "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-34ddc63fcebf3fe9696ed94aeab4355f": [{"violation_description": "EXPIRED PLATES OR TEMPORARY REGISTRATION", "total_tickets": 44811, "total_paid": 0, "repayment_rate": 0.0}, {"violation_description": "STREET CLEANING", "total_tickets": 28712, "total_paid": 0, "repayment_rate": 0.0}, {"violation_description": "RESIDENTIAL PERMIT PARKING", "total_tickets": 23683, "total_paid": 0, "repayment_rate": 0.0}]}}, {"mode": "vega-lite"});
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 3 Violation Types with Ticket Counts and Repayment Rates:
                        violation_description  total_tickets  repayment_rate
23   EXPIRED PLATES OR TEMPORARY REGISTRATION          44811             0.0
101                           STREET CLEANING          28712             0.0
90                 RESIDENTIAL PERMIT PARKING          23683             0.0</code></pre>
</div>
</div>
<div id="a4890051" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">##3.1</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data: replace with your actual DataFrame</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tickets_data = pd.read_csv('path_to_your_data.csv')</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> tickets_data.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    repayment_rate<span class="op">=</span>(<span class="st">'ticket_queue'</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">'Paid'</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(x)),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    avg_fine<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'ticket_number'</span>, <span class="st">'count'</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for violations that appear at least 100 times</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> violation_df[violation_df[<span class="st">'total_tickets'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by total tickets</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> violation_df.sort_values(by<span class="op">=</span><span class="st">'violation_description'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 5 violations</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(violation_df.head(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        violation_description  repayment_rate    avg_fine  \
118         WRONG DIRECTION OR 12'' FROM CURB        0.774977   25.000000   
117                WITHIN 15' OF FIRE HYDRANT        0.675459  116.079620   
116       WINDOWS MISSING OR CRACKED BEYOND 6        0.605903   25.000000   
110     TWO HEAD LAMPS REQUIRED VISIBLE 1000'        0.591422   25.000000   
109  TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET        0.694926   37.758405   

     total_tickets  
118           1111  
117           6104  
116            576  
110            443  
109           4789  </code></pre>
</div>
</div>
<div id="d0343601" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3.2</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import altair as alt</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> tickets_data.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    repayment_rate<span class="op">=</span>(<span class="st">'ticket_queue'</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">'Paid'</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(x)),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    avg_fine<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'ticket_number'</span>, <span class="st">'count'</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for violations that appear at least 100 times</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> violation_df[violation_df[<span class="st">'total_tickets'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove outlier (specify the violation to exclude)</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> violation_df[violation_df[<span class="st">'violation_description'</span>] <span class="op">!=</span> <span class="st">'Outlier Violation'</span>]</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>scatter_plot <span class="op">=</span> alt.Chart(violation_df).mark_circle(size<span class="op">=</span><span class="dv">60</span>).encode(</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'avg_fine:Q'</span>,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'repayment_rate:Q'</span>,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'violation_description:N'</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description:N'</span>, <span class="st">'avg_fine:Q'</span>, <span class="st">'repayment_rate:Q'</span>]</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Scatter Plot of Average Fine Amount vs. Repayment Rate'</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>scatter_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<style>
  #altair-viz-821d127704a7498fb7de42b1a55035e9.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-821d127704a7498fb7de42b1a55035e9.vega-embed details,
  #altair-viz-821d127704a7498fb7de42b1a55035e9.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-821d127704a7498fb7de42b1a55035e9"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-821d127704a7498fb7de42b1a55035e9") {
      outputDiv = document.getElementById("altair-viz-821d127704a7498fb7de42b1a55035e9");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-dc4e5d86f7e1578282ebbb2e99ec4089"}, "mark": {"type": "circle", "size": 60}, "encoding": {"color": {"field": "violation_description", "type": "nominal"}, "tooltip": [{"field": "violation_description", "type": "nominal"}, {"field": "avg_fine", "type": "quantitative"}, {"field": "repayment_rate", "type": "quantitative"}], "x": {"field": "avg_fine", "type": "quantitative"}, "y": {"field": "repayment_rate", "type": "quantitative"}}, "title": "Scatter Plot of Average Fine Amount vs. Repayment Rate", "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-dc4e5d86f7e1578282ebbb2e99ec4089": [{"violation_description": "20'OF CROSSWALK", "repayment_rate": 0.72264631043257, "avg_fine": 58.040712468193384, "total_tickets": 393}, {"violation_description": "3-7 AM SNOW ROUTE", "repayment_rate": 0.7115613825983313, "avg_fine": 55.60190703218117, "total_tickets": 839}, {"violation_description": "ABANDONED VEH. FOR 7 DAYS OR INOPERABLE", "repayment_rate": 0.2463768115942029, "avg_fine": 72.46376811594203, "total_tickets": 1104}, {"violation_description": "BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE", "repayment_rate": 0.6421785940468651, "avg_fine": 141.59278024065864, "total_tickets": 1579}, {"violation_description": "BURGLAR ALARM SOUNDING OVER 4 MINUTES", "repayment_rate": 0.7549019607843137, "avg_fine": 41.42156862745098, "total_tickets": 102}, {"violation_description": "CURB LOADING ZONE", "repayment_rate": 0.7053941908713693, "avg_fine": 58.12448132780083, "total_tickets": 1205}, {"violation_description": "DISABLED CURB CUT", "repayment_rate": 0.7706422018348624, "avg_fine": 75.0, "total_tickets": 436}, {"violation_description": "DISABLED PARKING ZONE", "repayment_rate": 0.5417895771878073, "avg_fine": 216.98623402163224, "total_tickets": 2034}, {"violation_description": "DOUBLE PARKING OR STANDING", "repayment_rate": 0.5902203856749312, "avg_fine": 100.0, "total_tickets": 2904}, {"violation_description": "EXP. METER NON-CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7929126213592232, "avg_fine": 46.59805825242719, "total_tickets": 20600}, {"violation_description": "EXPIRED METER CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7416803615447822, "avg_fine": 62.60836072308957, "total_tickets": 9736}, {"violation_description": "EXPIRED METER OR OVERSTAY", "repayment_rate": 0.8063552996374493, "avg_fine": 50.0, "total_tickets": 18756}, {"violation_description": "EXPIRED PLATE OR TEMPORARY REGISTRATION", "repayment_rate": 0.4077205882352941, "avg_fine": 60.0, "total_tickets": 2720}, {"violation_description": "EXPIRED PLATES OR TEMPORARY REGISTRATION", "repayment_rate": 0.604360536475419, "avg_fine": 54.96886925085359, "total_tickets": 44811}, {"violation_description": "HAZARDOUS DILAPIDATED VEHICLE", "repayment_rate": 0.24324324324324326, "avg_fine": 75.0, "total_tickets": 148}, {"violation_description": "HAZARDOUS DILAPITATED VEHICLE", "repayment_rate": 0.23154362416107382, "avg_fine": 69.12751677852349, "total_tickets": 298}, {"violation_description": "IMPROPER DISPLAY OF CITY STICKER", "repayment_rate": 0.7644110275689223, "avg_fine": 30.0, "total_tickets": 399}, {"violation_description": "INDUSTRIAL PERMIT PARKING", "repayment_rate": 0.8333333333333334, "avg_fine": 50.0, "total_tickets": 120}, {"violation_description": "LAMPS BROKEN OR INOPERABLE", "repayment_rate": 0.5987654320987654, "avg_fine": 25.0, "total_tickets": 162}, {"violation_description": "MISSING/NONCOMPLIANT FRONT AND/OR REAR PLATE", "repayment_rate": 0.322265625, "avg_fine": 60.0, "total_tickets": 1024}, {"violation_description": "NO CITY STICKER OR IMPROPER DISPLAY", "repayment_rate": 0.5433027011974381, "avg_fine": 120.0, "total_tickets": 10773}, {"violation_description": "NO CITY STICKER VEHICLE OVER 16,000 LBS.", "repayment_rate": 0.12213740458015267, "avg_fine": 500.0, "total_tickets": 131}, {"violation_description": "NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS.", "repayment_rate": 0.39835743366559034, "avg_fine": 200.0, "total_tickets": 14246}, {"violation_description": "NO PARK IN PRIVATE LOT", "repayment_rate": 0.582010582010582, "avg_fine": 25.0, "total_tickets": 378}, {"violation_description": "NO PARK IN PUBLIC LOT", "repayment_rate": 0.2857142857142857, "avg_fine": 48.319327731092436, "total_tickets": 119}, {"violation_description": "NO STANDING/PARKING TIME RESTRICTED", "repayment_rate": 0.7511574074074074, "avg_fine": 75.03819444444444, "total_tickets": 8640}, {"violation_description": "NON PYMT/NON-COM VEH PARKED IN COM LOADING ZONE", "repayment_rate": 0.45, "avg_fine": 140.0, "total_tickets": 100}, {"violation_description": "NONCOMPLIANT PLATE(S)", "repayment_rate": 0.6088541666666667, "avg_fine": 54.770833333333336, "total_tickets": 1920}, {"violation_description": "OBSTRUCT ROADWAY", "repayment_rate": 0.50285351934052, "avg_fine": 75.0, "total_tickets": 1577}, {"violation_description": "OBSTRUCTED OR IMPROPERLY TINTED WINDOWS", "repayment_rate": 0.5535055350553506, "avg_fine": 156.18081180811808, "total_tickets": 271}, {"violation_description": "OUTSIDE DIAGONAL MARKINGS", "repayment_rate": 0.7363636363636363, "avg_fine": 45.45454545454545, "total_tickets": 110}, {"violation_description": "PARK ALLEY", "repayment_rate": 0.40981963927855714, "avg_fine": 150.0, "total_tickets": 998}, {"violation_description": "PARK IN CITY LOT WHEN CLOSED", "repayment_rate": 0.7022222222222222, "avg_fine": 47.0, "total_tickets": 225}, {"violation_description": "PARK OR BLOCK ALLEY", "repayment_rate": 0.5253658536585366, "avg_fine": 150.0, "total_tickets": 2050}, {"violation_description": "PARK OR STAND IN BUS/TAXI/CARRIAGE STAND", "repayment_rate": 0.663724183877415, "avg_fine": 98.29447035309794, "total_tickets": 6004}, {"violation_description": "PARK OR STAND IN VIADUCT/UNDERPASS", "repayment_rate": 0.708502024291498, "avg_fine": 75.0, "total_tickets": 247}, {"violation_description": "PARK OR STAND ON CITY PROPERTY", "repayment_rate": 0.41530054644808745, "avg_fine": 48.36065573770492, "total_tickets": 183}, {"violation_description": "PARK OR STAND ON CROSSWALK", "repayment_rate": 0.7112135176651305, "avg_fine": 58.55094726062468, "total_tickets": 1953}, {"violation_description": "PARK OR STAND ON PARKWAY", "repayment_rate": 0.7232323232323232, "avg_fine": 59.23232323232323, "total_tickets": 495}, {"violation_description": "PARK OR STAND ON SIDEWALK", "repayment_rate": 0.6853281853281853, "avg_fine": 58.59073359073359, "total_tickets": 1036}, {"violation_description": "PARK OUTSIDE METERED SPACE", "repayment_rate": 0.5935251798561151, "avg_fine": 49.10071942446043, "total_tickets": 278}, {"violation_description": "PARK VEHICLE SOLE PURPOSE OF DISPLAYING FOR SALE", "repayment_rate": 0.1927710843373494, "avg_fine": 100.0, "total_tickets": 664}, {"violation_description": "PARK/STAND ON BICYCLE PATH", "repayment_rate": 0.6567796610169492, "avg_fine": 143.4322033898305, "total_tickets": 236}, {"violation_description": "PARKING/STANDING PROHIBITED ANYTIME", "repayment_rate": 0.705816837948666, "avg_fine": 66.14286437503164, "total_tickets": 19753}, {"violation_description": "REAR AND FRONT PLATE REQUIRED", "repayment_rate": 0.5304820266599279, "avg_fine": 54.61052498578558, "total_tickets": 15829}, {"violation_description": "REAR PLATE LIT AND LEGIBLE FOR 50'", "repayment_rate": 0.5636363636363636, "avg_fine": 25.0, "total_tickets": 110}, {"violation_description": "REAR PLATE REQUIRED MOTORCYCLE/TRAILER", "repayment_rate": 0.5710227272727273, "avg_fine": 59.43181818181818, "total_tickets": 352}, {"violation_description": "RED REAR LAMP REQUIRED VISIBLE 500'", "repayment_rate": 0.5565217391304348, "avg_fine": 25.0, "total_tickets": 115}, {"violation_description": "RESIDENTIAL PERMIT PARKING", "repayment_rate": 0.7422623822995398, "avg_fine": 66.33830173542204, "total_tickets": 23683}, {"violation_description": "RUSH HOUR PARKING", "repayment_rate": 0.7704137066443795, "avg_fine": 68.20977852068533, "total_tickets": 11965}, {"violation_description": "SAFETY BELTS REQUIRED", "repayment_rate": 0.7125382262996942, "avg_fine": 25.0, "total_tickets": 981}, {"violation_description": "SMOKED/TINTED WINDOWS PARKED/STANDING", "repayment_rate": 0.6246317030053035, "avg_fine": 151.0901591043017, "total_tickets": 1697}, {"violation_description": "SNOW ROUTE: 2'' OF SNOW OR MORE", "repayment_rate": 0.7083333333333334, "avg_fine": 60.0, "total_tickets": 144}, {"violation_description": "SPECIAL EVENTS RESTRICTION", "repayment_rate": 0.7748917748917749, "avg_fine": 59.95670995670996, "total_tickets": 462}, {"violation_description": "STAND, PARK, OR OTHER USE OF BUS LANE", "repayment_rate": 0.5936739659367397, "avg_fine": 90.0, "total_tickets": 1233}, {"violation_description": "STOP SIGN OR TRAFFIC SIGNAL", "repayment_rate": 0.8073938840712004, "avg_fine": 57.77955271565495, "total_tickets": 2191}, {"violation_description": "STREET CLEANING", "repayment_rate": 0.8116118696015603, "avg_fine": 54.00424909445528, "total_tickets": 28712}, {"violation_description": "STREET CLEANING OR SPECIAL EVENT", "repayment_rate": 0.7875370919881306, "avg_fine": 50.0, "total_tickets": 3370}, {"violation_description": "TRUCK OR SEMI-TRAILER PROHIBITED", "repayment_rate": 0.5310344827586206, "avg_fine": 125.0, "total_tickets": 145}, {"violation_description": "TRUCK TRAILOR/SEMI/TRAILER PROHIBITED", "repayment_rate": 0.4394904458598726, "avg_fine": 125.0, "total_tickets": 157}, {"violation_description": "TRUCK,MOTOR HOME, BUS BUSINESS STREET", "repayment_rate": 0.6907894736842105, "avg_fine": 27.30263157894737, "total_tickets": 456}, {"violation_description": "TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET", "repayment_rate": 0.6949258717895176, "avg_fine": 37.75840467738568, "total_tickets": 4789}, {"violation_description": "TWO HEAD LAMPS REQUIRED VISIBLE 1000'", "repayment_rate": 0.5914221218961625, "avg_fine": 25.0, "total_tickets": 443}, {"violation_description": "WINDOWS MISSING OR CRACKED BEYOND 6", "repayment_rate": 0.6059027777777778, "avg_fine": 25.0, "total_tickets": 576}, {"violation_description": "WITHIN 15' OF FIRE HYDRANT", "repayment_rate": 0.6754587155963303, "avg_fine": 116.07961992136305, "total_tickets": 6104}, {"violation_description": "WRONG DIRECTION OR 12'' FROM CURB", "repayment_rate": 0.774977497749775, "avg_fine": 25.0, "total_tickets": 1111}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="5dc46ae5" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3.2</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar Plot for Average Fine and Line Plot for Repayment Rate</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>bar_plot <span class="op">=</span> alt.Chart(violation_df).mark_bar(opacity<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'blue'</span>).encode(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'violation_description:N'</span>, title<span class="op">=</span><span class="st">'Violation Description'</span>, sort<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'avg_fine:Q'</span>, title<span class="op">=</span><span class="st">'Average Fine Amount'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Average Fine Amount and Repayment Rate by Violation Type'</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>line_plot <span class="op">=</span> alt.Chart(violation_df).mark_line(point<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'orange'</span>).encode(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'violation_description:N'</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'repayment_rate:Q'</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="op">=</span> bar_plot <span class="op">+</span> line_plot</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>combined_plot.configure_axisX(labelAngle<span class="op">=</span><span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<style>
  #altair-viz-6568d9a63c56448789fa5e53ba889bd3.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-6568d9a63c56448789fa5e53ba889bd3.vega-embed details,
  #altair-viz-6568d9a63c56448789fa5e53ba889bd3.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-6568d9a63c56448789fa5e53ba889bd3"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-6568d9a63c56448789fa5e53ba889bd3") {
      outputDiv = document.getElementById("altair-viz-6568d9a63c56448789fa5e53ba889bd3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "axisX": {"labelAngle": 45}}, "layer": [{"mark": {"type": "bar", "color": "blue", "opacity": 0.6}, "encoding": {"x": {"field": "violation_description", "sort": null, "title": "Violation Description", "type": "nominal"}, "y": {"field": "avg_fine", "title": "Average Fine Amount", "type": "quantitative"}}, "title": "Average Fine Amount and Repayment Rate by Violation Type"}, {"mark": {"type": "line", "color": "orange", "point": true}, "encoding": {"x": {"field": "violation_description", "type": "nominal"}, "y": {"field": "repayment_rate", "type": "quantitative"}}}], "data": {"name": "data-dc4e5d86f7e1578282ebbb2e99ec4089"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-dc4e5d86f7e1578282ebbb2e99ec4089": [{"violation_description": "20'OF CROSSWALK", "repayment_rate": 0.72264631043257, "avg_fine": 58.040712468193384, "total_tickets": 393}, {"violation_description": "3-7 AM SNOW ROUTE", "repayment_rate": 0.7115613825983313, "avg_fine": 55.60190703218117, "total_tickets": 839}, {"violation_description": "ABANDONED VEH. FOR 7 DAYS OR INOPERABLE", "repayment_rate": 0.2463768115942029, "avg_fine": 72.46376811594203, "total_tickets": 1104}, {"violation_description": "BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE", "repayment_rate": 0.6421785940468651, "avg_fine": 141.59278024065864, "total_tickets": 1579}, {"violation_description": "BURGLAR ALARM SOUNDING OVER 4 MINUTES", "repayment_rate": 0.7549019607843137, "avg_fine": 41.42156862745098, "total_tickets": 102}, {"violation_description": "CURB LOADING ZONE", "repayment_rate": 0.7053941908713693, "avg_fine": 58.12448132780083, "total_tickets": 1205}, {"violation_description": "DISABLED CURB CUT", "repayment_rate": 0.7706422018348624, "avg_fine": 75.0, "total_tickets": 436}, {"violation_description": "DISABLED PARKING ZONE", "repayment_rate": 0.5417895771878073, "avg_fine": 216.98623402163224, "total_tickets": 2034}, {"violation_description": "DOUBLE PARKING OR STANDING", "repayment_rate": 0.5902203856749312, "avg_fine": 100.0, "total_tickets": 2904}, {"violation_description": "EXP. METER NON-CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7929126213592232, "avg_fine": 46.59805825242719, "total_tickets": 20600}, {"violation_description": "EXPIRED METER CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7416803615447822, "avg_fine": 62.60836072308957, "total_tickets": 9736}, {"violation_description": "EXPIRED METER OR OVERSTAY", "repayment_rate": 0.8063552996374493, "avg_fine": 50.0, "total_tickets": 18756}, {"violation_description": "EXPIRED PLATE OR TEMPORARY REGISTRATION", "repayment_rate": 0.4077205882352941, "avg_fine": 60.0, "total_tickets": 2720}, {"violation_description": "EXPIRED PLATES OR TEMPORARY REGISTRATION", "repayment_rate": 0.604360536475419, "avg_fine": 54.96886925085359, "total_tickets": 44811}, {"violation_description": "HAZARDOUS DILAPIDATED VEHICLE", "repayment_rate": 0.24324324324324326, "avg_fine": 75.0, "total_tickets": 148}, {"violation_description": "HAZARDOUS DILAPITATED VEHICLE", "repayment_rate": 0.23154362416107382, "avg_fine": 69.12751677852349, "total_tickets": 298}, {"violation_description": "IMPROPER DISPLAY OF CITY STICKER", "repayment_rate": 0.7644110275689223, "avg_fine": 30.0, "total_tickets": 399}, {"violation_description": "INDUSTRIAL PERMIT PARKING", "repayment_rate": 0.8333333333333334, "avg_fine": 50.0, "total_tickets": 120}, {"violation_description": "LAMPS BROKEN OR INOPERABLE", "repayment_rate": 0.5987654320987654, "avg_fine": 25.0, "total_tickets": 162}, {"violation_description": "MISSING/NONCOMPLIANT FRONT AND/OR REAR PLATE", "repayment_rate": 0.322265625, "avg_fine": 60.0, "total_tickets": 1024}, {"violation_description": "NO CITY STICKER OR IMPROPER DISPLAY", "repayment_rate": 0.5433027011974381, "avg_fine": 120.0, "total_tickets": 10773}, {"violation_description": "NO CITY STICKER VEHICLE OVER 16,000 LBS.", "repayment_rate": 0.12213740458015267, "avg_fine": 500.0, "total_tickets": 131}, {"violation_description": "NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS.", "repayment_rate": 0.39835743366559034, "avg_fine": 200.0, "total_tickets": 14246}, {"violation_description": "NO PARK IN PRIVATE LOT", "repayment_rate": 0.582010582010582, "avg_fine": 25.0, "total_tickets": 378}, {"violation_description": "NO PARK IN PUBLIC LOT", "repayment_rate": 0.2857142857142857, "avg_fine": 48.319327731092436, "total_tickets": 119}, {"violation_description": "NO STANDING/PARKING TIME RESTRICTED", "repayment_rate": 0.7511574074074074, "avg_fine": 75.03819444444444, "total_tickets": 8640}, {"violation_description": "NON PYMT/NON-COM VEH PARKED IN COM LOADING ZONE", "repayment_rate": 0.45, "avg_fine": 140.0, "total_tickets": 100}, {"violation_description": "NONCOMPLIANT PLATE(S)", "repayment_rate": 0.6088541666666667, "avg_fine": 54.770833333333336, "total_tickets": 1920}, {"violation_description": "OBSTRUCT ROADWAY", "repayment_rate": 0.50285351934052, "avg_fine": 75.0, "total_tickets": 1577}, {"violation_description": "OBSTRUCTED OR IMPROPERLY TINTED WINDOWS", "repayment_rate": 0.5535055350553506, "avg_fine": 156.18081180811808, "total_tickets": 271}, {"violation_description": "OUTSIDE DIAGONAL MARKINGS", "repayment_rate": 0.7363636363636363, "avg_fine": 45.45454545454545, "total_tickets": 110}, {"violation_description": "PARK ALLEY", "repayment_rate": 0.40981963927855714, "avg_fine": 150.0, "total_tickets": 998}, {"violation_description": "PARK IN CITY LOT WHEN CLOSED", "repayment_rate": 0.7022222222222222, "avg_fine": 47.0, "total_tickets": 225}, {"violation_description": "PARK OR BLOCK ALLEY", "repayment_rate": 0.5253658536585366, "avg_fine": 150.0, "total_tickets": 2050}, {"violation_description": "PARK OR STAND IN BUS/TAXI/CARRIAGE STAND", "repayment_rate": 0.663724183877415, "avg_fine": 98.29447035309794, "total_tickets": 6004}, {"violation_description": "PARK OR STAND IN VIADUCT/UNDERPASS", "repayment_rate": 0.708502024291498, "avg_fine": 75.0, "total_tickets": 247}, {"violation_description": "PARK OR STAND ON CITY PROPERTY", "repayment_rate": 0.41530054644808745, "avg_fine": 48.36065573770492, "total_tickets": 183}, {"violation_description": "PARK OR STAND ON CROSSWALK", "repayment_rate": 0.7112135176651305, "avg_fine": 58.55094726062468, "total_tickets": 1953}, {"violation_description": "PARK OR STAND ON PARKWAY", "repayment_rate": 0.7232323232323232, "avg_fine": 59.23232323232323, "total_tickets": 495}, {"violation_description": "PARK OR STAND ON SIDEWALK", "repayment_rate": 0.6853281853281853, "avg_fine": 58.59073359073359, "total_tickets": 1036}, {"violation_description": "PARK OUTSIDE METERED SPACE", "repayment_rate": 0.5935251798561151, "avg_fine": 49.10071942446043, "total_tickets": 278}, {"violation_description": "PARK VEHICLE SOLE PURPOSE OF DISPLAYING FOR SALE", "repayment_rate": 0.1927710843373494, "avg_fine": 100.0, "total_tickets": 664}, {"violation_description": "PARK/STAND ON BICYCLE PATH", "repayment_rate": 0.6567796610169492, "avg_fine": 143.4322033898305, "total_tickets": 236}, {"violation_description": "PARKING/STANDING PROHIBITED ANYTIME", "repayment_rate": 0.705816837948666, "avg_fine": 66.14286437503164, "total_tickets": 19753}, {"violation_description": "REAR AND FRONT PLATE REQUIRED", "repayment_rate": 0.5304820266599279, "avg_fine": 54.61052498578558, "total_tickets": 15829}, {"violation_description": "REAR PLATE LIT AND LEGIBLE FOR 50'", "repayment_rate": 0.5636363636363636, "avg_fine": 25.0, "total_tickets": 110}, {"violation_description": "REAR PLATE REQUIRED MOTORCYCLE/TRAILER", "repayment_rate": 0.5710227272727273, "avg_fine": 59.43181818181818, "total_tickets": 352}, {"violation_description": "RED REAR LAMP REQUIRED VISIBLE 500'", "repayment_rate": 0.5565217391304348, "avg_fine": 25.0, "total_tickets": 115}, {"violation_description": "RESIDENTIAL PERMIT PARKING", "repayment_rate": 0.7422623822995398, "avg_fine": 66.33830173542204, "total_tickets": 23683}, {"violation_description": "RUSH HOUR PARKING", "repayment_rate": 0.7704137066443795, "avg_fine": 68.20977852068533, "total_tickets": 11965}, {"violation_description": "SAFETY BELTS REQUIRED", "repayment_rate": 0.7125382262996942, "avg_fine": 25.0, "total_tickets": 981}, {"violation_description": "SMOKED/TINTED WINDOWS PARKED/STANDING", "repayment_rate": 0.6246317030053035, "avg_fine": 151.0901591043017, "total_tickets": 1697}, {"violation_description": "SNOW ROUTE: 2'' OF SNOW OR MORE", "repayment_rate": 0.7083333333333334, "avg_fine": 60.0, "total_tickets": 144}, {"violation_description": "SPECIAL EVENTS RESTRICTION", "repayment_rate": 0.7748917748917749, "avg_fine": 59.95670995670996, "total_tickets": 462}, {"violation_description": "STAND, PARK, OR OTHER USE OF BUS LANE", "repayment_rate": 0.5936739659367397, "avg_fine": 90.0, "total_tickets": 1233}, {"violation_description": "STOP SIGN OR TRAFFIC SIGNAL", "repayment_rate": 0.8073938840712004, "avg_fine": 57.77955271565495, "total_tickets": 2191}, {"violation_description": "STREET CLEANING", "repayment_rate": 0.8116118696015603, "avg_fine": 54.00424909445528, "total_tickets": 28712}, {"violation_description": "STREET CLEANING OR SPECIAL EVENT", "repayment_rate": 0.7875370919881306, "avg_fine": 50.0, "total_tickets": 3370}, {"violation_description": "TRUCK OR SEMI-TRAILER PROHIBITED", "repayment_rate": 0.5310344827586206, "avg_fine": 125.0, "total_tickets": 145}, {"violation_description": "TRUCK TRAILOR/SEMI/TRAILER PROHIBITED", "repayment_rate": 0.4394904458598726, "avg_fine": 125.0, "total_tickets": 157}, {"violation_description": "TRUCK,MOTOR HOME, BUS BUSINESS STREET", "repayment_rate": 0.6907894736842105, "avg_fine": 27.30263157894737, "total_tickets": 456}, {"violation_description": "TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET", "repayment_rate": 0.6949258717895176, "avg_fine": 37.75840467738568, "total_tickets": 4789}, {"violation_description": "TWO HEAD LAMPS REQUIRED VISIBLE 1000'", "repayment_rate": 0.5914221218961625, "avg_fine": 25.0, "total_tickets": 443}, {"violation_description": "WINDOWS MISSING OR CRACKED BEYOND 6", "repayment_rate": 0.6059027777777778, "avg_fine": 25.0, "total_tickets": 576}, {"violation_description": "WITHIN 15' OF FIRE HYDRANT", "repayment_rate": 0.6754587155963303, "avg_fine": 116.07961992136305, "total_tickets": 6104}, {"violation_description": "WRONG DIRECTION OR 12'' FROM CURB", "repayment_rate": 0.774977497749775, "avg_fine": 25.0, "total_tickets": 1111}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="ee1df68f" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3.2</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Box Plot for Distribution of Average Fine Amounts</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>box_plot <span class="op">=</span> alt.Chart(violation_df).mark_boxplot().encode(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'violation_description:N'</span>, title<span class="op">=</span><span class="st">'Violation Description'</span>, sort<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'avg_fine:Q'</span>, title<span class="op">=</span><span class="st">'Average Fine Amount'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Distribution of Average Fine Amount by Violation Type'</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>box_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

<style>
  #altair-viz-3a6a5bd5eda6435ea820ffe8c56afe5f.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-3a6a5bd5eda6435ea820ffe8c56afe5f.vega-embed details,
  #altair-viz-3a6a5bd5eda6435ea820ffe8c56afe5f.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-3a6a5bd5eda6435ea820ffe8c56afe5f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-3a6a5bd5eda6435ea820ffe8c56afe5f") {
      outputDiv = document.getElementById("altair-viz-3a6a5bd5eda6435ea820ffe8c56afe5f");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-dc4e5d86f7e1578282ebbb2e99ec4089"}, "mark": {"type": "boxplot"}, "encoding": {"x": {"field": "violation_description", "sort": null, "title": "Violation Description", "type": "nominal"}, "y": {"field": "avg_fine", "title": "Average Fine Amount", "type": "quantitative"}}, "title": "Distribution of Average Fine Amount by Violation Type", "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-dc4e5d86f7e1578282ebbb2e99ec4089": [{"violation_description": "20'OF CROSSWALK", "repayment_rate": 0.72264631043257, "avg_fine": 58.040712468193384, "total_tickets": 393}, {"violation_description": "3-7 AM SNOW ROUTE", "repayment_rate": 0.7115613825983313, "avg_fine": 55.60190703218117, "total_tickets": 839}, {"violation_description": "ABANDONED VEH. FOR 7 DAYS OR INOPERABLE", "repayment_rate": 0.2463768115942029, "avg_fine": 72.46376811594203, "total_tickets": 1104}, {"violation_description": "BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE", "repayment_rate": 0.6421785940468651, "avg_fine": 141.59278024065864, "total_tickets": 1579}, {"violation_description": "BURGLAR ALARM SOUNDING OVER 4 MINUTES", "repayment_rate": 0.7549019607843137, "avg_fine": 41.42156862745098, "total_tickets": 102}, {"violation_description": "CURB LOADING ZONE", "repayment_rate": 0.7053941908713693, "avg_fine": 58.12448132780083, "total_tickets": 1205}, {"violation_description": "DISABLED CURB CUT", "repayment_rate": 0.7706422018348624, "avg_fine": 75.0, "total_tickets": 436}, {"violation_description": "DISABLED PARKING ZONE", "repayment_rate": 0.5417895771878073, "avg_fine": 216.98623402163224, "total_tickets": 2034}, {"violation_description": "DOUBLE PARKING OR STANDING", "repayment_rate": 0.5902203856749312, "avg_fine": 100.0, "total_tickets": 2904}, {"violation_description": "EXP. METER NON-CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7929126213592232, "avg_fine": 46.59805825242719, "total_tickets": 20600}, {"violation_description": "EXPIRED METER CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7416803615447822, "avg_fine": 62.60836072308957, "total_tickets": 9736}, {"violation_description": "EXPIRED METER OR OVERSTAY", "repayment_rate": 0.8063552996374493, "avg_fine": 50.0, "total_tickets": 18756}, {"violation_description": "EXPIRED PLATE OR TEMPORARY REGISTRATION", "repayment_rate": 0.4077205882352941, "avg_fine": 60.0, "total_tickets": 2720}, {"violation_description": "EXPIRED PLATES OR TEMPORARY REGISTRATION", "repayment_rate": 0.604360536475419, "avg_fine": 54.96886925085359, "total_tickets": 44811}, {"violation_description": "HAZARDOUS DILAPIDATED VEHICLE", "repayment_rate": 0.24324324324324326, "avg_fine": 75.0, "total_tickets": 148}, {"violation_description": "HAZARDOUS DILAPITATED VEHICLE", "repayment_rate": 0.23154362416107382, "avg_fine": 69.12751677852349, "total_tickets": 298}, {"violation_description": "IMPROPER DISPLAY OF CITY STICKER", "repayment_rate": 0.7644110275689223, "avg_fine": 30.0, "total_tickets": 399}, {"violation_description": "INDUSTRIAL PERMIT PARKING", "repayment_rate": 0.8333333333333334, "avg_fine": 50.0, "total_tickets": 120}, {"violation_description": "LAMPS BROKEN OR INOPERABLE", "repayment_rate": 0.5987654320987654, "avg_fine": 25.0, "total_tickets": 162}, {"violation_description": "MISSING/NONCOMPLIANT FRONT AND/OR REAR PLATE", "repayment_rate": 0.322265625, "avg_fine": 60.0, "total_tickets": 1024}, {"violation_description": "NO CITY STICKER OR IMPROPER DISPLAY", "repayment_rate": 0.5433027011974381, "avg_fine": 120.0, "total_tickets": 10773}, {"violation_description": "NO CITY STICKER VEHICLE OVER 16,000 LBS.", "repayment_rate": 0.12213740458015267, "avg_fine": 500.0, "total_tickets": 131}, {"violation_description": "NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS.", "repayment_rate": 0.39835743366559034, "avg_fine": 200.0, "total_tickets": 14246}, {"violation_description": "NO PARK IN PRIVATE LOT", "repayment_rate": 0.582010582010582, "avg_fine": 25.0, "total_tickets": 378}, {"violation_description": "NO PARK IN PUBLIC LOT", "repayment_rate": 0.2857142857142857, "avg_fine": 48.319327731092436, "total_tickets": 119}, {"violation_description": "NO STANDING/PARKING TIME RESTRICTED", "repayment_rate": 0.7511574074074074, "avg_fine": 75.03819444444444, "total_tickets": 8640}, {"violation_description": "NON PYMT/NON-COM VEH PARKED IN COM LOADING ZONE", "repayment_rate": 0.45, "avg_fine": 140.0, "total_tickets": 100}, {"violation_description": "NONCOMPLIANT PLATE(S)", "repayment_rate": 0.6088541666666667, "avg_fine": 54.770833333333336, "total_tickets": 1920}, {"violation_description": "OBSTRUCT ROADWAY", "repayment_rate": 0.50285351934052, "avg_fine": 75.0, "total_tickets": 1577}, {"violation_description": "OBSTRUCTED OR IMPROPERLY TINTED WINDOWS", "repayment_rate": 0.5535055350553506, "avg_fine": 156.18081180811808, "total_tickets": 271}, {"violation_description": "OUTSIDE DIAGONAL MARKINGS", "repayment_rate": 0.7363636363636363, "avg_fine": 45.45454545454545, "total_tickets": 110}, {"violation_description": "PARK ALLEY", "repayment_rate": 0.40981963927855714, "avg_fine": 150.0, "total_tickets": 998}, {"violation_description": "PARK IN CITY LOT WHEN CLOSED", "repayment_rate": 0.7022222222222222, "avg_fine": 47.0, "total_tickets": 225}, {"violation_description": "PARK OR BLOCK ALLEY", "repayment_rate": 0.5253658536585366, "avg_fine": 150.0, "total_tickets": 2050}, {"violation_description": "PARK OR STAND IN BUS/TAXI/CARRIAGE STAND", "repayment_rate": 0.663724183877415, "avg_fine": 98.29447035309794, "total_tickets": 6004}, {"violation_description": "PARK OR STAND IN VIADUCT/UNDERPASS", "repayment_rate": 0.708502024291498, "avg_fine": 75.0, "total_tickets": 247}, {"violation_description": "PARK OR STAND ON CITY PROPERTY", "repayment_rate": 0.41530054644808745, "avg_fine": 48.36065573770492, "total_tickets": 183}, {"violation_description": "PARK OR STAND ON CROSSWALK", "repayment_rate": 0.7112135176651305, "avg_fine": 58.55094726062468, "total_tickets": 1953}, {"violation_description": "PARK OR STAND ON PARKWAY", "repayment_rate": 0.7232323232323232, "avg_fine": 59.23232323232323, "total_tickets": 495}, {"violation_description": "PARK OR STAND ON SIDEWALK", "repayment_rate": 0.6853281853281853, "avg_fine": 58.59073359073359, "total_tickets": 1036}, {"violation_description": "PARK OUTSIDE METERED SPACE", "repayment_rate": 0.5935251798561151, "avg_fine": 49.10071942446043, "total_tickets": 278}, {"violation_description": "PARK VEHICLE SOLE PURPOSE OF DISPLAYING FOR SALE", "repayment_rate": 0.1927710843373494, "avg_fine": 100.0, "total_tickets": 664}, {"violation_description": "PARK/STAND ON BICYCLE PATH", "repayment_rate": 0.6567796610169492, "avg_fine": 143.4322033898305, "total_tickets": 236}, {"violation_description": "PARKING/STANDING PROHIBITED ANYTIME", "repayment_rate": 0.705816837948666, "avg_fine": 66.14286437503164, "total_tickets": 19753}, {"violation_description": "REAR AND FRONT PLATE REQUIRED", "repayment_rate": 0.5304820266599279, "avg_fine": 54.61052498578558, "total_tickets": 15829}, {"violation_description": "REAR PLATE LIT AND LEGIBLE FOR 50'", "repayment_rate": 0.5636363636363636, "avg_fine": 25.0, "total_tickets": 110}, {"violation_description": "REAR PLATE REQUIRED MOTORCYCLE/TRAILER", "repayment_rate": 0.5710227272727273, "avg_fine": 59.43181818181818, "total_tickets": 352}, {"violation_description": "RED REAR LAMP REQUIRED VISIBLE 500'", "repayment_rate": 0.5565217391304348, "avg_fine": 25.0, "total_tickets": 115}, {"violation_description": "RESIDENTIAL PERMIT PARKING", "repayment_rate": 0.7422623822995398, "avg_fine": 66.33830173542204, "total_tickets": 23683}, {"violation_description": "RUSH HOUR PARKING", "repayment_rate": 0.7704137066443795, "avg_fine": 68.20977852068533, "total_tickets": 11965}, {"violation_description": "SAFETY BELTS REQUIRED", "repayment_rate": 0.7125382262996942, "avg_fine": 25.0, "total_tickets": 981}, {"violation_description": "SMOKED/TINTED WINDOWS PARKED/STANDING", "repayment_rate": 0.6246317030053035, "avg_fine": 151.0901591043017, "total_tickets": 1697}, {"violation_description": "SNOW ROUTE: 2'' OF SNOW OR MORE", "repayment_rate": 0.7083333333333334, "avg_fine": 60.0, "total_tickets": 144}, {"violation_description": "SPECIAL EVENTS RESTRICTION", "repayment_rate": 0.7748917748917749, "avg_fine": 59.95670995670996, "total_tickets": 462}, {"violation_description": "STAND, PARK, OR OTHER USE OF BUS LANE", "repayment_rate": 0.5936739659367397, "avg_fine": 90.0, "total_tickets": 1233}, {"violation_description": "STOP SIGN OR TRAFFIC SIGNAL", "repayment_rate": 0.8073938840712004, "avg_fine": 57.77955271565495, "total_tickets": 2191}, {"violation_description": "STREET CLEANING", "repayment_rate": 0.8116118696015603, "avg_fine": 54.00424909445528, "total_tickets": 28712}, {"violation_description": "STREET CLEANING OR SPECIAL EVENT", "repayment_rate": 0.7875370919881306, "avg_fine": 50.0, "total_tickets": 3370}, {"violation_description": "TRUCK OR SEMI-TRAILER PROHIBITED", "repayment_rate": 0.5310344827586206, "avg_fine": 125.0, "total_tickets": 145}, {"violation_description": "TRUCK TRAILOR/SEMI/TRAILER PROHIBITED", "repayment_rate": 0.4394904458598726, "avg_fine": 125.0, "total_tickets": 157}, {"violation_description": "TRUCK,MOTOR HOME, BUS BUSINESS STREET", "repayment_rate": 0.6907894736842105, "avg_fine": 27.30263157894737, "total_tickets": 456}, {"violation_description": "TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET", "repayment_rate": 0.6949258717895176, "avg_fine": 37.75840467738568, "total_tickets": 4789}, {"violation_description": "TWO HEAD LAMPS REQUIRED VISIBLE 1000'", "repayment_rate": 0.5914221218961625, "avg_fine": 25.0, "total_tickets": 443}, {"violation_description": "WINDOWS MISSING OR CRACKED BEYOND 6", "repayment_rate": 0.6059027777777778, "avg_fine": 25.0, "total_tickets": 576}, {"violation_description": "WITHIN 15' OF FIRE HYDRANT", "repayment_rate": 0.6754587155963303, "avg_fine": 116.07961992136305, "total_tickets": 6104}, {"violation_description": "WRONG DIRECTION OR 12'' FROM CURB", "repayment_rate": 0.774977497749775, "avg_fine": 25.0, "total_tickets": 1111}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="40f10e83" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#4.1</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import pandas as pd</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data loading</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tickets_data = pd.read_csv('path_to_your_data.csv')</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame for violations with at least 100 citations</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> tickets_data.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'ticket_number'</span>, <span class="st">'count'</span>),</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    paid_fine<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="kw">lambda</span> x: x[tickets_data[<span class="st">'ticket_queue'</span>] <span class="op">==</span> <span class="st">'Paid'</span>].mean()),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    unpaid_fine<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="kw">lambda</span> x: x[tickets_data[<span class="st">'ticket_queue'</span>] <span class="op">!=</span> <span class="st">'Paid'</span>].mean())</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for violations with at least 100 citations</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> violation_df[violation_df[<span class="st">'total_tickets'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate if the fine doubles and the increase in amount</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>violation_df[<span class="st">'fine_doubles'</span>] <span class="op">=</span> violation_df[<span class="st">'unpaid_fine'</span>] <span class="op">==</span> <span class="dv">2</span> <span class="op">*</span> violation_df[<span class="st">'paid_fine'</span>]</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>violation_df[<span class="st">'increase_if_unpaid'</span>] <span class="op">=</span> violation_df[<span class="st">'unpaid_fine'</span>] <span class="op">-</span> violation_df[<span class="st">'paid_fine'</span>]</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>non_doubling_violations <span class="op">=</span> violation_df[<span class="op">~</span>violation_df[<span class="st">'fine_doubles'</span>]]</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(non_doubling_violations[[<span class="st">'violation_description'</span>, <span class="st">'paid_fine'</span>, <span class="st">'unpaid_fine'</span>, <span class="st">'increase_if_unpaid'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        violation_description   paid_fine  unpaid_fine  \
1                             20'OF CROSSWALK   58.397887    57.110092   
2                           3-7 AM SNOW ROUTE   55.427136    56.033058   
3     ABANDONED VEH. FOR 7 DAYS OR INOPERABLE   71.599265    72.746394   
5        BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE  140.236686   144.026549   
9       BURGLAR ALARM SOUNDING OVER 4 MINUTES   41.233766    42.000000   
..                                        ...         ...          ...   
109  TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET   35.877404    42.043121   
110     TWO HEAD LAMPS REQUIRED VISIBLE 1000'   25.000000    25.000000   
116       WINDOWS MISSING OR CRACKED BEYOND 6   25.000000    25.000000   
117                WITHIN 15' OF FIRE HYDRANT  114.613146   119.131752   
118         WRONG DIRECTION OR 12'' FROM CURB   25.000000    25.000000   

     increase_if_unpaid  
1             -1.287796  
2              0.605922  
3              1.147130  
5              3.789862  
9              0.766234  
..                  ...  
109            6.165717  
110            0.000000  
116            0.000000  
117            4.518606  
118            0.000000  

[66 rows x 4 columns]</code></pre>
</div>
</div>
<div id="d48329c5" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Explanation for 4.1</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">##Negative Increases:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">##For some violations (e.g., 20' OF CROSSWALK), the increase_if_unpaid is negative, meaning that the unpaid fine is lower than the paid fine by about $1.29. This is unusual since typically, one would expect unpaid fines to be at least equal to or greater than the paid fines.</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">##Positive Increases:</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">##Violations like TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET show a positive increase of about $6.17. This indicates that the fine for unpaid tickets is higher than that for paid tickets, which might suggest that certain violations have a small increase for unpaid tickets but do not double in price.</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">##Not Doubling: Out of the 66 violations listed, none follow the typical doubling rule for unpaid tickets. Instead, many have either a slight increase, no increase, or even a decrease in the unpaid fine compared to the paid fine.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>##4.2</p>
<div id="6790ec81" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#4.3</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">##Identifying top-ten violations</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>top_10_violations <span class="op">=</span> violation_df.nlargest(<span class="dv">10</span>, <span class="st">'total_tickets'</span>)[<span class="st">'violation_description'</span>].tolist()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column to label violations</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>violation_df[<span class="st">'label'</span>] <span class="op">=</span> violation_df[<span class="st">'violation_description'</span>].<span class="bu">apply</span>(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> top_10_violations <span class="cf">else</span> <span class="st">'Other'</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the labeling is done correctly</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(violation_df[[<span class="st">'violation_description'</span>, <span class="st">'label'</span>]].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     violation_description  label
1                          20'OF CROSSWALK  Other
2                        3-7 AM SNOW ROUTE  Other
3  ABANDONED VEH. FOR 7 DAYS OR INOPERABLE  Other
5     BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE  Other
9    BURGLAR ALARM SOUNDING OVER 4 MINUTES  Other</code></pre>
</div>
</div>
<div id="d891e979" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="429e7bc1" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">##4.3</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#label every dot with adjacent text</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data: replace with your actual DataFrame</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># tickets_data = pd.read_csv('path_to_your_data.csv')</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> tickets_data.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    repayment_rate<span class="op">=</span>(<span class="st">'ticket_queue'</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">'Paid'</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(x)),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    avg_fine<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'ticket_number'</span>, <span class="st">'count'</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for violations that appear at least 100 times</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>violation_df <span class="op">=</span> violation_df[violation_df[<span class="st">'total_tickets'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the top 10 violation descriptions</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>top_violations <span class="op">=</span> violation_df.nlargest(<span class="dv">10</span>, <span class="st">'total_tickets'</span>)[<span class="st">'violation_description'</span>].tolist()</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column for labeling</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>violation_df[<span class="st">'label'</span>] <span class="op">=</span> violation_df[<span class="st">'violation_description'</span>].where(violation_df[<span class="st">'violation_description'</span>].isin(top_violations), <span class="st">'Other'</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot with Labels</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>scatter_with_labels <span class="op">=</span> alt.Chart(violation_df).mark_circle(size<span class="op">=</span><span class="dv">60</span>).encode(</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'avg_fine:Q'</span>,</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'repayment_rate:Q'</span>,</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'label:N'</span>,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description:N'</span>, <span class="st">'avg_fine:Q'</span>, <span class="st">'repayment_rate:Q'</span>]</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Scatter Plot of Average Fine Amount vs. Repayment Rate'</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>text_labels <span class="op">=</span> scatter_with_labels.mark_text(</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    align<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    dy<span class="op">=-</span><span class="dv">5</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">'label:N'</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine scatter and text labels</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>scatter_with_labels <span class="op">+</span> text_labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">

<style>
  #altair-viz-7537893b6642405a8884111795e8fe06.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-7537893b6642405a8884111795e8fe06.vega-embed details,
  #altair-viz-7537893b6642405a8884111795e8fe06.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-7537893b6642405a8884111795e8fe06"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7537893b6642405a8884111795e8fe06") {
      outputDiv = document.getElementById("altair-viz-7537893b6642405a8884111795e8fe06");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "circle", "size": 60}, "encoding": {"color": {"field": "label", "type": "nominal"}, "tooltip": [{"field": "violation_description", "type": "nominal"}, {"field": "avg_fine", "type": "quantitative"}, {"field": "repayment_rate", "type": "quantitative"}], "x": {"field": "avg_fine", "type": "quantitative"}, "y": {"field": "repayment_rate", "type": "quantitative"}}, "title": "Scatter Plot of Average Fine Amount vs. Repayment Rate"}, {"mark": {"type": "text", "align": "left", "dx": 5, "dy": -5}, "encoding": {"color": {"field": "label", "type": "nominal"}, "text": {"field": "label", "type": "nominal"}, "tooltip": [{"field": "violation_description", "type": "nominal"}, {"field": "avg_fine", "type": "quantitative"}, {"field": "repayment_rate", "type": "quantitative"}], "x": {"field": "avg_fine", "type": "quantitative"}, "y": {"field": "repayment_rate", "type": "quantitative"}}, "title": "Scatter Plot of Average Fine Amount vs. Repayment Rate"}], "data": {"name": "data-8fb71f204ab5b651f2ed3334cfb37632"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-8fb71f204ab5b651f2ed3334cfb37632": [{"violation_description": "20'OF CROSSWALK", "repayment_rate": 0.72264631043257, "avg_fine": 58.040712468193384, "total_tickets": 393, "label": "Other"}, {"violation_description": "3-7 AM SNOW ROUTE", "repayment_rate": 0.7115613825983313, "avg_fine": 55.60190703218117, "total_tickets": 839, "label": "Other"}, {"violation_description": "ABANDONED VEH. FOR 7 DAYS OR INOPERABLE", "repayment_rate": 0.2463768115942029, "avg_fine": 72.46376811594203, "total_tickets": 1104, "label": "Other"}, {"violation_description": "BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE", "repayment_rate": 0.6421785940468651, "avg_fine": 141.59278024065864, "total_tickets": 1579, "label": "Other"}, {"violation_description": "BURGLAR ALARM SOUNDING OVER 4 MINUTES", "repayment_rate": 0.7549019607843137, "avg_fine": 41.42156862745098, "total_tickets": 102, "label": "Other"}, {"violation_description": "CURB LOADING ZONE", "repayment_rate": 0.7053941908713693, "avg_fine": 58.12448132780083, "total_tickets": 1205, "label": "Other"}, {"violation_description": "DISABLED CURB CUT", "repayment_rate": 0.7706422018348624, "avg_fine": 75.0, "total_tickets": 436, "label": "Other"}, {"violation_description": "DISABLED PARKING ZONE", "repayment_rate": 0.5417895771878073, "avg_fine": 216.98623402163224, "total_tickets": 2034, "label": "Other"}, {"violation_description": "DOUBLE PARKING OR STANDING", "repayment_rate": 0.5902203856749312, "avg_fine": 100.0, "total_tickets": 2904, "label": "Other"}, {"violation_description": "EXP. METER NON-CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7929126213592232, "avg_fine": 46.59805825242719, "total_tickets": 20600, "label": "EXP. METER NON-CENTRAL BUSINESS DISTRICT"}, {"violation_description": "EXPIRED METER CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7416803615447822, "avg_fine": 62.60836072308957, "total_tickets": 9736, "label": "Other"}, {"violation_description": "EXPIRED METER OR OVERSTAY", "repayment_rate": 0.8063552996374493, "avg_fine": 50.0, "total_tickets": 18756, "label": "EXPIRED METER OR OVERSTAY"}, {"violation_description": "EXPIRED PLATE OR TEMPORARY REGISTRATION", "repayment_rate": 0.4077205882352941, "avg_fine": 60.0, "total_tickets": 2720, "label": "Other"}, {"violation_description": "EXPIRED PLATES OR TEMPORARY REGISTRATION", "repayment_rate": 0.604360536475419, "avg_fine": 54.96886925085359, "total_tickets": 44811, "label": "EXPIRED PLATES OR TEMPORARY REGISTRATION"}, {"violation_description": "HAZARDOUS DILAPIDATED VEHICLE", "repayment_rate": 0.24324324324324326, "avg_fine": 75.0, "total_tickets": 148, "label": "Other"}, {"violation_description": "HAZARDOUS DILAPITATED VEHICLE", "repayment_rate": 0.23154362416107382, "avg_fine": 69.12751677852349, "total_tickets": 298, "label": "Other"}, {"violation_description": "IMPROPER DISPLAY OF CITY STICKER", "repayment_rate": 0.7644110275689223, "avg_fine": 30.0, "total_tickets": 399, "label": "Other"}, {"violation_description": "INDUSTRIAL PERMIT PARKING", "repayment_rate": 0.8333333333333334, "avg_fine": 50.0, "total_tickets": 120, "label": "Other"}, {"violation_description": "LAMPS BROKEN OR INOPERABLE", "repayment_rate": 0.5987654320987654, "avg_fine": 25.0, "total_tickets": 162, "label": "Other"}, {"violation_description": "MISSING/NONCOMPLIANT FRONT AND/OR REAR PLATE", "repayment_rate": 0.322265625, "avg_fine": 60.0, "total_tickets": 1024, "label": "Other"}, {"violation_description": "NO CITY STICKER OR IMPROPER DISPLAY", "repayment_rate": 0.5433027011974381, "avg_fine": 120.0, "total_tickets": 10773, "label": "NO CITY STICKER OR IMPROPER DISPLAY"}, {"violation_description": "NO CITY STICKER VEHICLE OVER 16,000 LBS.", "repayment_rate": 0.12213740458015267, "avg_fine": 500.0, "total_tickets": 131, "label": "Other"}, {"violation_description": "NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS.", "repayment_rate": 0.39835743366559034, "avg_fine": 200.0, "total_tickets": 14246, "label": "NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS."}, {"violation_description": "NO PARK IN PRIVATE LOT", "repayment_rate": 0.582010582010582, "avg_fine": 25.0, "total_tickets": 378, "label": "Other"}, {"violation_description": "NO PARK IN PUBLIC LOT", "repayment_rate": 0.2857142857142857, "avg_fine": 48.319327731092436, "total_tickets": 119, "label": "Other"}, {"violation_description": "NO STANDING/PARKING TIME RESTRICTED", "repayment_rate": 0.7511574074074074, "avg_fine": 75.03819444444444, "total_tickets": 8640, "label": "Other"}, {"violation_description": "NON PYMT/NON-COM VEH PARKED IN COM LOADING ZONE", "repayment_rate": 0.45, "avg_fine": 140.0, "total_tickets": 100, "label": "Other"}, {"violation_description": "NONCOMPLIANT PLATE(S)", "repayment_rate": 0.6088541666666667, "avg_fine": 54.770833333333336, "total_tickets": 1920, "label": "Other"}, {"violation_description": "OBSTRUCT ROADWAY", "repayment_rate": 0.50285351934052, "avg_fine": 75.0, "total_tickets": 1577, "label": "Other"}, {"violation_description": "OBSTRUCTED OR IMPROPERLY TINTED WINDOWS", "repayment_rate": 0.5535055350553506, "avg_fine": 156.18081180811808, "total_tickets": 271, "label": "Other"}, {"violation_description": "OUTSIDE DIAGONAL MARKINGS", "repayment_rate": 0.7363636363636363, "avg_fine": 45.45454545454545, "total_tickets": 110, "label": "Other"}, {"violation_description": "PARK ALLEY", "repayment_rate": 0.40981963927855714, "avg_fine": 150.0, "total_tickets": 998, "label": "Other"}, {"violation_description": "PARK IN CITY LOT WHEN CLOSED", "repayment_rate": 0.7022222222222222, "avg_fine": 47.0, "total_tickets": 225, "label": "Other"}, {"violation_description": "PARK OR BLOCK ALLEY", "repayment_rate": 0.5253658536585366, "avg_fine": 150.0, "total_tickets": 2050, "label": "Other"}, {"violation_description": "PARK OR STAND IN BUS/TAXI/CARRIAGE STAND", "repayment_rate": 0.663724183877415, "avg_fine": 98.29447035309794, "total_tickets": 6004, "label": "Other"}, {"violation_description": "PARK OR STAND IN VIADUCT/UNDERPASS", "repayment_rate": 0.708502024291498, "avg_fine": 75.0, "total_tickets": 247, "label": "Other"}, {"violation_description": "PARK OR STAND ON CITY PROPERTY", "repayment_rate": 0.41530054644808745, "avg_fine": 48.36065573770492, "total_tickets": 183, "label": "Other"}, {"violation_description": "PARK OR STAND ON CROSSWALK", "repayment_rate": 0.7112135176651305, "avg_fine": 58.55094726062468, "total_tickets": 1953, "label": "Other"}, {"violation_description": "PARK OR STAND ON PARKWAY", "repayment_rate": 0.7232323232323232, "avg_fine": 59.23232323232323, "total_tickets": 495, "label": "Other"}, {"violation_description": "PARK OR STAND ON SIDEWALK", "repayment_rate": 0.6853281853281853, "avg_fine": 58.59073359073359, "total_tickets": 1036, "label": "Other"}, {"violation_description": "PARK OUTSIDE METERED SPACE", "repayment_rate": 0.5935251798561151, "avg_fine": 49.10071942446043, "total_tickets": 278, "label": "Other"}, {"violation_description": "PARK VEHICLE SOLE PURPOSE OF DISPLAYING FOR SALE", "repayment_rate": 0.1927710843373494, "avg_fine": 100.0, "total_tickets": 664, "label": "Other"}, {"violation_description": "PARK/STAND ON BICYCLE PATH", "repayment_rate": 0.6567796610169492, "avg_fine": 143.4322033898305, "total_tickets": 236, "label": "Other"}, {"violation_description": "PARKING/STANDING PROHIBITED ANYTIME", "repayment_rate": 0.705816837948666, "avg_fine": 66.14286437503164, "total_tickets": 19753, "label": "PARKING/STANDING PROHIBITED ANYTIME"}, {"violation_description": "REAR AND FRONT PLATE REQUIRED", "repayment_rate": 0.5304820266599279, "avg_fine": 54.61052498578558, "total_tickets": 15829, "label": "REAR AND FRONT PLATE REQUIRED"}, {"violation_description": "REAR PLATE LIT AND LEGIBLE FOR 50'", "repayment_rate": 0.5636363636363636, "avg_fine": 25.0, "total_tickets": 110, "label": "Other"}, {"violation_description": "REAR PLATE REQUIRED MOTORCYCLE/TRAILER", "repayment_rate": 0.5710227272727273, "avg_fine": 59.43181818181818, "total_tickets": 352, "label": "Other"}, {"violation_description": "RED REAR LAMP REQUIRED VISIBLE 500'", "repayment_rate": 0.5565217391304348, "avg_fine": 25.0, "total_tickets": 115, "label": "Other"}, {"violation_description": "RESIDENTIAL PERMIT PARKING", "repayment_rate": 0.7422623822995398, "avg_fine": 66.33830173542204, "total_tickets": 23683, "label": "RESIDENTIAL PERMIT PARKING"}, {"violation_description": "RUSH HOUR PARKING", "repayment_rate": 0.7704137066443795, "avg_fine": 68.20977852068533, "total_tickets": 11965, "label": "RUSH HOUR PARKING"}, {"violation_description": "SAFETY BELTS REQUIRED", "repayment_rate": 0.7125382262996942, "avg_fine": 25.0, "total_tickets": 981, "label": "Other"}, {"violation_description": "SMOKED/TINTED WINDOWS PARKED/STANDING", "repayment_rate": 0.6246317030053035, "avg_fine": 151.0901591043017, "total_tickets": 1697, "label": "Other"}, {"violation_description": "SNOW ROUTE: 2'' OF SNOW OR MORE", "repayment_rate": 0.7083333333333334, "avg_fine": 60.0, "total_tickets": 144, "label": "Other"}, {"violation_description": "SPECIAL EVENTS RESTRICTION", "repayment_rate": 0.7748917748917749, "avg_fine": 59.95670995670996, "total_tickets": 462, "label": "Other"}, {"violation_description": "STAND, PARK, OR OTHER USE OF BUS LANE", "repayment_rate": 0.5936739659367397, "avg_fine": 90.0, "total_tickets": 1233, "label": "Other"}, {"violation_description": "STOP SIGN OR TRAFFIC SIGNAL", "repayment_rate": 0.8073938840712004, "avg_fine": 57.77955271565495, "total_tickets": 2191, "label": "Other"}, {"violation_description": "STREET CLEANING", "repayment_rate": 0.8116118696015603, "avg_fine": 54.00424909445528, "total_tickets": 28712, "label": "STREET CLEANING"}, {"violation_description": "STREET CLEANING OR SPECIAL EVENT", "repayment_rate": 0.7875370919881306, "avg_fine": 50.0, "total_tickets": 3370, "label": "Other"}, {"violation_description": "TRUCK OR SEMI-TRAILER PROHIBITED", "repayment_rate": 0.5310344827586206, "avg_fine": 125.0, "total_tickets": 145, "label": "Other"}, {"violation_description": "TRUCK TRAILOR/SEMI/TRAILER PROHIBITED", "repayment_rate": 0.4394904458598726, "avg_fine": 125.0, "total_tickets": 157, "label": "Other"}, {"violation_description": "TRUCK,MOTOR HOME, BUS BUSINESS STREET", "repayment_rate": 0.6907894736842105, "avg_fine": 27.30263157894737, "total_tickets": 456, "label": "Other"}, {"violation_description": "TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET", "repayment_rate": 0.6949258717895176, "avg_fine": 37.75840467738568, "total_tickets": 4789, "label": "Other"}, {"violation_description": "TWO HEAD LAMPS REQUIRED VISIBLE 1000'", "repayment_rate": 0.5914221218961625, "avg_fine": 25.0, "total_tickets": 443, "label": "Other"}, {"violation_description": "WINDOWS MISSING OR CRACKED BEYOND 6", "repayment_rate": 0.6059027777777778, "avg_fine": 25.0, "total_tickets": 576, "label": "Other"}, {"violation_description": "WITHIN 15' OF FIRE HYDRANT", "repayment_rate": 0.6754587155963303, "avg_fine": 116.07961992136305, "total_tickets": 6104, "label": "Other"}, {"violation_description": "WRONG DIRECTION OR 12'' FROM CURB", "repayment_rate": 0.774977497749775, "avg_fine": 25.0, "total_tickets": 1111, "label": "Other"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="433f7716" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#4.3(b)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define categories for violation descriptions</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_violation(description):</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'parking'</span> <span class="kw">in</span> description.lower():</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Parking Violations'</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'speed'</span> <span class="kw">in</span> description.lower():</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Speed Violations'</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'license'</span> <span class="kw">in</span> description.lower():</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'License Violations'</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'registration'</span> <span class="kw">in</span> description.lower():</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Registration Violations'</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other Violations'</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply categorization</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>violation_df[<span class="st">'category'</span>] <span class="op">=</span> violation_df[<span class="st">'violation_description'</span>].<span class="bu">apply</span>(categorize_violation)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter Plot with Categories</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>scatter_with_categories <span class="op">=</span> alt.Chart(violation_df).mark_circle(size<span class="op">=</span><span class="dv">60</span>).encode(</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'avg_fine:Q'</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'repayment_rate:Q'</span>,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'category:N'</span>,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description:N'</span>, <span class="st">'avg_fine:Q'</span>, <span class="st">'repayment_rate:Q'</span>]</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Scatter Plot of Average Fine Amount vs. Repayment Rate (Categorized)'</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend to show categories</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>scatter_with_categories</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<style>
  #altair-viz-21795ebb761b4991b6bf01b43dc91252.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-21795ebb761b4991b6bf01b43dc91252.vega-embed details,
  #altair-viz-21795ebb761b4991b6bf01b43dc91252.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-21795ebb761b4991b6bf01b43dc91252"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-21795ebb761b4991b6bf01b43dc91252") {
      outputDiv = document.getElementById("altair-viz-21795ebb761b4991b6bf01b43dc91252");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-81c8bf2371bac09c76d3ceddab6fef62"}, "mark": {"type": "circle", "size": 60}, "encoding": {"color": {"field": "category", "type": "nominal"}, "tooltip": [{"field": "violation_description", "type": "nominal"}, {"field": "avg_fine", "type": "quantitative"}, {"field": "repayment_rate", "type": "quantitative"}], "x": {"field": "avg_fine", "type": "quantitative"}, "y": {"field": "repayment_rate", "type": "quantitative"}}, "title": "Scatter Plot of Average Fine Amount vs. Repayment Rate (Categorized)", "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-81c8bf2371bac09c76d3ceddab6fef62": [{"violation_description": "20'OF CROSSWALK", "repayment_rate": 0.72264631043257, "avg_fine": 58.040712468193384, "total_tickets": 393, "label": "Other", "category": "Other Violations"}, {"violation_description": "3-7 AM SNOW ROUTE", "repayment_rate": 0.7115613825983313, "avg_fine": 55.60190703218117, "total_tickets": 839, "label": "Other", "category": "Other Violations"}, {"violation_description": "ABANDONED VEH. FOR 7 DAYS OR INOPERABLE", "repayment_rate": 0.2463768115942029, "avg_fine": 72.46376811594203, "total_tickets": 1104, "label": "Other", "category": "Other Violations"}, {"violation_description": "BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE", "repayment_rate": 0.6421785940468651, "avg_fine": 141.59278024065864, "total_tickets": 1579, "label": "Other", "category": "Other Violations"}, {"violation_description": "BURGLAR ALARM SOUNDING OVER 4 MINUTES", "repayment_rate": 0.7549019607843137, "avg_fine": 41.42156862745098, "total_tickets": 102, "label": "Other", "category": "Other Violations"}, {"violation_description": "CURB LOADING ZONE", "repayment_rate": 0.7053941908713693, "avg_fine": 58.12448132780083, "total_tickets": 1205, "label": "Other", "category": "Other Violations"}, {"violation_description": "DISABLED CURB CUT", "repayment_rate": 0.7706422018348624, "avg_fine": 75.0, "total_tickets": 436, "label": "Other", "category": "Other Violations"}, {"violation_description": "DISABLED PARKING ZONE", "repayment_rate": 0.5417895771878073, "avg_fine": 216.98623402163224, "total_tickets": 2034, "label": "Other", "category": "Parking Violations"}, {"violation_description": "DOUBLE PARKING OR STANDING", "repayment_rate": 0.5902203856749312, "avg_fine": 100.0, "total_tickets": 2904, "label": "Other", "category": "Parking Violations"}, {"violation_description": "EXP. METER NON-CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7929126213592232, "avg_fine": 46.59805825242719, "total_tickets": 20600, "label": "EXP. METER NON-CENTRAL BUSINESS DISTRICT", "category": "Other Violations"}, {"violation_description": "EXPIRED METER CENTRAL BUSINESS DISTRICT", "repayment_rate": 0.7416803615447822, "avg_fine": 62.60836072308957, "total_tickets": 9736, "label": "Other", "category": "Other Violations"}, {"violation_description": "EXPIRED METER OR OVERSTAY", "repayment_rate": 0.8063552996374493, "avg_fine": 50.0, "total_tickets": 18756, "label": "EXPIRED METER OR OVERSTAY", "category": "Other Violations"}, {"violation_description": "EXPIRED PLATE OR TEMPORARY REGISTRATION", "repayment_rate": 0.4077205882352941, "avg_fine": 60.0, "total_tickets": 2720, "label": "Other", "category": "Registration Violations"}, {"violation_description": "EXPIRED PLATES OR TEMPORARY REGISTRATION", "repayment_rate": 0.604360536475419, "avg_fine": 54.96886925085359, "total_tickets": 44811, "label": "EXPIRED PLATES OR TEMPORARY REGISTRATION", "category": "Registration Violations"}, {"violation_description": "HAZARDOUS DILAPIDATED VEHICLE", "repayment_rate": 0.24324324324324326, "avg_fine": 75.0, "total_tickets": 148, "label": "Other", "category": "Other Violations"}, {"violation_description": "HAZARDOUS DILAPITATED VEHICLE", "repayment_rate": 0.23154362416107382, "avg_fine": 69.12751677852349, "total_tickets": 298, "label": "Other", "category": "Other Violations"}, {"violation_description": "IMPROPER DISPLAY OF CITY STICKER", "repayment_rate": 0.7644110275689223, "avg_fine": 30.0, "total_tickets": 399, "label": "Other", "category": "Other Violations"}, {"violation_description": "INDUSTRIAL PERMIT PARKING", "repayment_rate": 0.8333333333333334, "avg_fine": 50.0, "total_tickets": 120, "label": "Other", "category": "Parking Violations"}, {"violation_description": "LAMPS BROKEN OR INOPERABLE", "repayment_rate": 0.5987654320987654, "avg_fine": 25.0, "total_tickets": 162, "label": "Other", "category": "Other Violations"}, {"violation_description": "MISSING/NONCOMPLIANT FRONT AND/OR REAR PLATE", "repayment_rate": 0.322265625, "avg_fine": 60.0, "total_tickets": 1024, "label": "Other", "category": "Other Violations"}, {"violation_description": "NO CITY STICKER OR IMPROPER DISPLAY", "repayment_rate": 0.5433027011974381, "avg_fine": 120.0, "total_tickets": 10773, "label": "NO CITY STICKER OR IMPROPER DISPLAY", "category": "Other Violations"}, {"violation_description": "NO CITY STICKER VEHICLE OVER 16,000 LBS.", "repayment_rate": 0.12213740458015267, "avg_fine": 500.0, "total_tickets": 131, "label": "Other", "category": "Other Violations"}, {"violation_description": "NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS.", "repayment_rate": 0.39835743366559034, "avg_fine": 200.0, "total_tickets": 14246, "label": "NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS.", "category": "Other Violations"}, {"violation_description": "NO PARK IN PRIVATE LOT", "repayment_rate": 0.582010582010582, "avg_fine": 25.0, "total_tickets": 378, "label": "Other", "category": "Other Violations"}, {"violation_description": "NO PARK IN PUBLIC LOT", "repayment_rate": 0.2857142857142857, "avg_fine": 48.319327731092436, "total_tickets": 119, "label": "Other", "category": "Other Violations"}, {"violation_description": "NO STANDING/PARKING TIME RESTRICTED", "repayment_rate": 0.7511574074074074, "avg_fine": 75.03819444444444, "total_tickets": 8640, "label": "Other", "category": "Parking Violations"}, {"violation_description": "NON PYMT/NON-COM VEH PARKED IN COM LOADING ZONE", "repayment_rate": 0.45, "avg_fine": 140.0, "total_tickets": 100, "label": "Other", "category": "Other Violations"}, {"violation_description": "NONCOMPLIANT PLATE(S)", "repayment_rate": 0.6088541666666667, "avg_fine": 54.770833333333336, "total_tickets": 1920, "label": "Other", "category": "Other Violations"}, {"violation_description": "OBSTRUCT ROADWAY", "repayment_rate": 0.50285351934052, "avg_fine": 75.0, "total_tickets": 1577, "label": "Other", "category": "Other Violations"}, {"violation_description": "OBSTRUCTED OR IMPROPERLY TINTED WINDOWS", "repayment_rate": 0.5535055350553506, "avg_fine": 156.18081180811808, "total_tickets": 271, "label": "Other", "category": "Other Violations"}, {"violation_description": "OUTSIDE DIAGONAL MARKINGS", "repayment_rate": 0.7363636363636363, "avg_fine": 45.45454545454545, "total_tickets": 110, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK ALLEY", "repayment_rate": 0.40981963927855714, "avg_fine": 150.0, "total_tickets": 998, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK IN CITY LOT WHEN CLOSED", "repayment_rate": 0.7022222222222222, "avg_fine": 47.0, "total_tickets": 225, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OR BLOCK ALLEY", "repayment_rate": 0.5253658536585366, "avg_fine": 150.0, "total_tickets": 2050, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OR STAND IN BUS/TAXI/CARRIAGE STAND", "repayment_rate": 0.663724183877415, "avg_fine": 98.29447035309794, "total_tickets": 6004, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OR STAND IN VIADUCT/UNDERPASS", "repayment_rate": 0.708502024291498, "avg_fine": 75.0, "total_tickets": 247, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OR STAND ON CITY PROPERTY", "repayment_rate": 0.41530054644808745, "avg_fine": 48.36065573770492, "total_tickets": 183, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OR STAND ON CROSSWALK", "repayment_rate": 0.7112135176651305, "avg_fine": 58.55094726062468, "total_tickets": 1953, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OR STAND ON PARKWAY", "repayment_rate": 0.7232323232323232, "avg_fine": 59.23232323232323, "total_tickets": 495, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OR STAND ON SIDEWALK", "repayment_rate": 0.6853281853281853, "avg_fine": 58.59073359073359, "total_tickets": 1036, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK OUTSIDE METERED SPACE", "repayment_rate": 0.5935251798561151, "avg_fine": 49.10071942446043, "total_tickets": 278, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK VEHICLE SOLE PURPOSE OF DISPLAYING FOR SALE", "repayment_rate": 0.1927710843373494, "avg_fine": 100.0, "total_tickets": 664, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARK/STAND ON BICYCLE PATH", "repayment_rate": 0.6567796610169492, "avg_fine": 143.4322033898305, "total_tickets": 236, "label": "Other", "category": "Other Violations"}, {"violation_description": "PARKING/STANDING PROHIBITED ANYTIME", "repayment_rate": 0.705816837948666, "avg_fine": 66.14286437503164, "total_tickets": 19753, "label": "PARKING/STANDING PROHIBITED ANYTIME", "category": "Parking Violations"}, {"violation_description": "REAR AND FRONT PLATE REQUIRED", "repayment_rate": 0.5304820266599279, "avg_fine": 54.61052498578558, "total_tickets": 15829, "label": "REAR AND FRONT PLATE REQUIRED", "category": "Other Violations"}, {"violation_description": "REAR PLATE LIT AND LEGIBLE FOR 50'", "repayment_rate": 0.5636363636363636, "avg_fine": 25.0, "total_tickets": 110, "label": "Other", "category": "Other Violations"}, {"violation_description": "REAR PLATE REQUIRED MOTORCYCLE/TRAILER", "repayment_rate": 0.5710227272727273, "avg_fine": 59.43181818181818, "total_tickets": 352, "label": "Other", "category": "Other Violations"}, {"violation_description": "RED REAR LAMP REQUIRED VISIBLE 500'", "repayment_rate": 0.5565217391304348, "avg_fine": 25.0, "total_tickets": 115, "label": "Other", "category": "Other Violations"}, {"violation_description": "RESIDENTIAL PERMIT PARKING", "repayment_rate": 0.7422623822995398, "avg_fine": 66.33830173542204, "total_tickets": 23683, "label": "RESIDENTIAL PERMIT PARKING", "category": "Parking Violations"}, {"violation_description": "RUSH HOUR PARKING", "repayment_rate": 0.7704137066443795, "avg_fine": 68.20977852068533, "total_tickets": 11965, "label": "RUSH HOUR PARKING", "category": "Parking Violations"}, {"violation_description": "SAFETY BELTS REQUIRED", "repayment_rate": 0.7125382262996942, "avg_fine": 25.0, "total_tickets": 981, "label": "Other", "category": "Other Violations"}, {"violation_description": "SMOKED/TINTED WINDOWS PARKED/STANDING", "repayment_rate": 0.6246317030053035, "avg_fine": 151.0901591043017, "total_tickets": 1697, "label": "Other", "category": "Other Violations"}, {"violation_description": "SNOW ROUTE: 2'' OF SNOW OR MORE", "repayment_rate": 0.7083333333333334, "avg_fine": 60.0, "total_tickets": 144, "label": "Other", "category": "Other Violations"}, {"violation_description": "SPECIAL EVENTS RESTRICTION", "repayment_rate": 0.7748917748917749, "avg_fine": 59.95670995670996, "total_tickets": 462, "label": "Other", "category": "Other Violations"}, {"violation_description": "STAND, PARK, OR OTHER USE OF BUS LANE", "repayment_rate": 0.5936739659367397, "avg_fine": 90.0, "total_tickets": 1233, "label": "Other", "category": "Other Violations"}, {"violation_description": "STOP SIGN OR TRAFFIC SIGNAL", "repayment_rate": 0.8073938840712004, "avg_fine": 57.77955271565495, "total_tickets": 2191, "label": "Other", "category": "Other Violations"}, {"violation_description": "STREET CLEANING", "repayment_rate": 0.8116118696015603, "avg_fine": 54.00424909445528, "total_tickets": 28712, "label": "STREET CLEANING", "category": "Other Violations"}, {"violation_description": "STREET CLEANING OR SPECIAL EVENT", "repayment_rate": 0.7875370919881306, "avg_fine": 50.0, "total_tickets": 3370, "label": "Other", "category": "Other Violations"}, {"violation_description": "TRUCK OR SEMI-TRAILER PROHIBITED", "repayment_rate": 0.5310344827586206, "avg_fine": 125.0, "total_tickets": 145, "label": "Other", "category": "Other Violations"}, {"violation_description": "TRUCK TRAILOR/SEMI/TRAILER PROHIBITED", "repayment_rate": 0.4394904458598726, "avg_fine": 125.0, "total_tickets": 157, "label": "Other", "category": "Other Violations"}, {"violation_description": "TRUCK,MOTOR HOME, BUS BUSINESS STREET", "repayment_rate": 0.6907894736842105, "avg_fine": 27.30263157894737, "total_tickets": 456, "label": "Other", "category": "Other Violations"}, {"violation_description": "TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET", "repayment_rate": 0.6949258717895176, "avg_fine": 37.75840467738568, "total_tickets": 4789, "label": "Other", "category": "Other Violations"}, {"violation_description": "TWO HEAD LAMPS REQUIRED VISIBLE 1000'", "repayment_rate": 0.5914221218961625, "avg_fine": 25.0, "total_tickets": 443, "label": "Other", "category": "Other Violations"}, {"violation_description": "WINDOWS MISSING OR CRACKED BEYOND 6", "repayment_rate": 0.6059027777777778, "avg_fine": 25.0, "total_tickets": 576, "label": "Other", "category": "Other Violations"}, {"violation_description": "WITHIN 15' OF FIRE HYDRANT", "repayment_rate": 0.6754587155963303, "avg_fine": 116.07961992136305, "total_tickets": 6104, "label": "Other", "category": "Other Violations"}, {"violation_description": "WRONG DIRECTION OR 12'' FROM CURB", "repayment_rate": 0.774977497749775, "avg_fine": 25.0, "total_tickets": 1111, "label": "Other", "category": "Other Violations"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="886460fb" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">##BONUS QUESTION</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming tickets_data is your original DataFrame</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with necessary columns</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>violation_data <span class="op">=</span> tickets_data[[<span class="st">'violation_code'</span>, <span class="st">'violation_description'</span>]]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by violation_code and count unique violation_descriptions</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>violation_summary <span class="op">=</span> violation_data.groupby(<span class="st">'violation_code'</span>).agg(</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    num_descriptions<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    most_common_description<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="kw">lambda</span> x: x.mode()[<span class="dv">0</span>]),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    total_observations<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="st">'count'</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for codes with multiple descriptions</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>multiple_descriptions <span class="op">=</span> violation_summary[violation_summary[<span class="st">'num_descriptions'</span>] <span class="op">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the three codes with the most observations</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>top_three_codes <span class="op">=</span> multiple_descriptions.nlargest(<span class="dv">3</span>, <span class="st">'total_observations'</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_three_codes[[<span class="st">'violation_code'</span>, <span class="st">'num_descriptions'</span>, <span class="st">'most_common_description'</span>, <span class="st">'total_observations'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   violation_code  num_descriptions                  most_common_description  \
9        0964040B                 2                          STREET CLEANING   
90       0976160A                 2            REAR AND FRONT PLATE REQUIRED   
91       0976160B                 2  EXPIRED PLATE OR TEMPORARY REGISTRATION   

    total_observations  
9                32082  
90               16853  
91                3072  </code></pre>
</div>
</div>
<hr>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>